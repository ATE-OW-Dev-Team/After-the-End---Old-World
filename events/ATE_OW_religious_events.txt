namespace = ATE_OW_REL
character_event = {
	id = ATE_OW_REL.1 # Not used, using scripted effect instead
	hide_window = yes
	trigger = {
		death_reason = death_jacobinist_sacrifice
		killer = { 
			is_playable = yes
			is_landed = yes
			NOT = { trait = incapable }
			religion = jacobinist
		}
	}
	
	is_triggered_only = yes

	immediate = { 
		killer = { 
			#Bonus points first.
			if = { #A religious head is also quite good.
				limit = {
					FROM = { controls_religion = yes }
				}
				change_variable = { which = guillotine_points value = 2 }
			}
			if = { #A emperor is also well accepted.
				limit = {
					FROM = { higher_tier_than = KING }
				}
				change_variable = { which = guillotine_points value = 1 }
			}
			#Finally, a third point is added regardless in the following scripted effect, which will also trigger the events below, when the proper score is reached.
			jacobinist_sacrifice_tiered_traits_effect = yes 
		}
	}
}
character_event = {
	id = ATE_OW_REL.2
	desc = EVTDESCATE_OW_REL2
	
	picture = GFX_evt_animated_guillotine
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTAATE_OW_REL2
	}
}
character_event = {
	id = ATE_OW_REL.3
	
	picture = GFX_evt_animated_guillotine
	border = GFX_event_normal_frame_war
	desc = { 
		trigger = { 
			religion = jacobinist
		} 
		text = EVTDESCATE_OW_REL3A
	}
	desc = {
		trigger = { 
			NOT = { religion = jacobinist }
		} 
		text = EVTDESCATE_OW_REL3B
	}
	is_triggered_only = yes
	
	option = {
		trigger = { 
			religion = jacobinist
		}
		name = EVTOPTAATE_OW_REL3
		piety = 100
	}
	option = {
		trigger = { 
			NOT = { religion = jacobinist }
		}
		name = EVTOPTBATE_OW_REL3
	}
}
character_event = {
	id = ATE_OW_REL.4
	
	picture = GFX_evt_animated_guillotine
	border = GFX_event_normal_frame_war
	desc = { 
		trigger = {
			NOR = {
				trait = guillotine_master_1
				trait = guillotine_master_2
				trait = guillotine_master_3
				has_character_flag = becoming_guillotine_master_1
			}
		} 
		text = EVTDESCATE_OW_REL4A
	}
	desc = {
		trigger = {
			OR = {
				trait = guillotine_master_1
				trait = guillotine_master_2
				trait = guillotine_master_3
			}
		} 
		text = EVTDESCATE_OW_REL4B
	}
	desc = {
		trigger = {
			has_character_flag = becoming_guillotine_master_1
		} 
		text = EVTDESCATE_OW_REL4C
	}
	is_triggered_only = yes
	immediate = {
		if = { 
			limit = { FROM = { is_ruler = no } }
			set_variable = { which = local_sacrifice_piety_gain value = 5 }
		}
		if = { 
			limit = { FROM = { tier = BARON } }
			set_variable = { which = local_sacrifice_piety_gain value = 15 }
		}
		if = { 
			limit = { FROM = { tier = COUNT } }
			set_variable = { which = local_sacrifice_piety_gain value = 30 }
		}
		if = { 
			limit = { FROM = { tier = DUKE } }
			set_variable = { which = local_sacrifice_piety_gain value = 75 }
		}
		if = { 
			limit = { FROM = { tier = KING } }
			set_variable = { which = local_sacrifice_piety_gain value = 150 }
		}
		if = { 
			limit = { FROM = { tier = EMPEROR } }
			set_variable = { which = local_sacrifice_piety_gain value = 250 }
		}
		FROM = {
			calculate_madame_preference_effect = yes
		}
		if = {
			limit = {
				FROM = { higher_tier_than = BARON }
			}
			multiply_variable = { which = local_sacrifice_piety_gain which = local_madame_preference }
			set_variable = { which = local_sacrifice_piety_gain_read which = local_sacrifice_piety_gain }
			multiply_variable = { which = local_sacrifice_piety_gain_read value = 0.6 }
		}
		else = {
			set_variable = { which = local_madame_preference_calc which = local_madame_preference }
			subtract_variable = { which = local_madame_preference_calc value = 1 }
			multiply_variable = { which = local_madame_preference_calc value = 25 }
			change_variable = { which = local_sacrifice_piety_gain which = local_madame_preference_calc }
			set_variable = { which = local_sacrifice_piety_gain_read which = local_sacrifice_piety_gain }
			if = {
				limit = {
					check_variable = { which = local_sacrifice_piety_gain_read value = 0 }
					NOT = { is_variable_equal = { which = local_sacrifice_piety_gain_read value = 0 } }
				}
				multiply_variable = { which = local_sacrifice_piety_gain_read value = 0.6 }
			}
			else = {
				subtract_variable = { which = local_sacrifice_piety_gain_read value = 2 }
			}
		}
		if = { # Is this even possible?
			limit = {
				check_variable = { which = local_madame_preference value = 3 }
			}
			change_variable = { which = guillotine_points value = 1 }
		}
		if = {
			limit = {
				check_variable = { which = local_madame_preference value = 2.6 }
			}
			change_variable = { which = guillotine_points value = 1 }
		}
		if = {
			limit = {
				check_variable = { which = local_madame_preference value = 2.2 }
			}
			change_variable = { which = guillotine_points value = 1 }
		}
		if = {
			limit = {
				check_variable = { which = local_madame_preference value = 1.8 }
			}
			change_variable = { which = guillotine_points value = 1 }
		}
		if = {
			limit = {
				check_variable = { which = local_madame_preference value = 1.4 }
			}
			jacobinist_sacrifice_tiered_traits_effect = yes
		}
	}
	option = {
		name = EVTOPTAATE_OW_REL4
		piety = local_sacrifice_piety_gain
		set_character_flag = decided_wont_read
	}
	option = {
		name = EVTOPTBATE_OW_REL4
		trigger = { 
			OR = {
				trait = guillotine_master_1
				trait = guillotine_master_2
				trait = guillotine_master_3
				has_character_flag = becoming_guillotine_master_1
			}
			job_spiritual = { always = yes }
		}
		set_character_flag = read_message_priest
		job_spiritual = { save_event_target_as = message_reader }
		piety = local_sacrifice_piety_gain_read
	}
	option = {
		name = EVTOPTCATE_OW_REL4
		trigger = { 
			OR = {
				trait = guillotine_master_2
				trait = guillotine_master_3
				has_character_flag = becoming_guillotine_master_2
			}
		}
		save_event_target_as = message_reader
		piety = local_sacrifice_piety_gain_read
	}
	after = {
		jacobinist_gain_tiered_traits_effect = yes
		if = {
			limit = { event_target:message_reader = { always = yes } }
			event_target:message_reader = {
				show_scope_change = no
				random_list = {
					80 = { # Nothing...
						madame_reading_outcome_score = yes
						job_event_mtth_modifier_learning_score = yes
						ROOT = { character_event = { id = ATE_OW_REL.5 } }
					}
					20 = { # Learns the preference of the madame
						ROOT = { character_event = { id = ATE_OW_REL.6 } }
					}
					5 = { # Madame gives you a special opportunity
						modifier = { factor = 0 }
						modifier = {
							factor = 0
							ROOT = {
								NOR = {
									trait = guillotine_master_2
									trait = guillotine_master_3
									has_character_flag = ongoing_quest_madame
								}
							}
						}
						modifier = { factor = 1.1 character = ROOT } #bonus for doing it yourself
						modifier = { factor = 1.1 learning = 18 } #bonus for really high learning
						modifier = { factor = 1.1 learning = 19 }
						modifier = { factor = 1.1 learning = 20 }
						modifier = { factor = 1.1 learning = 21 }
						modifier = { factor = 1.1 learning = 22 }
					}
					1 = { # Madame asks you to begin a legendary journey
						modifier = { factor = 0 }
						modifier = {
							factor = 0
							ROOT = {
								NOR = {
									trait = guillotine_master_3
									has_character_flag = legendary_journey_madame
								}
							}
						}
						modifier = { factor = 1.1 character = ROOT } #bonus for doing it yourself
						modifier = { factor = 1.1 learning = 18 } #bonus for really high learning
						modifier = { factor = 1.1 learning = 19 }
						modifier = { factor = 1.1 learning = 20 }
						modifier = { factor = 1.1 learning = 21 }
						modifier = { factor = 1.1 learning = 22 }
						modifier = { factor = 1.1 check_variable = { which = finished_madame_quests value = 1 } } # bonus if finished quests for the madame
						modifier = { factor = 1.1 check_variable = { which = finished_madame_quests value = 2 } }
						modifier = { factor = 1.1 check_variable = { which = finished_madame_quests value = 3 } }
					}
				}
			}
		}
	}
}
character_event = {
	id = ATE_OW_REL.5 # Learns the preference of the madame
	
	picture = GFX_evt_beheading
	border = GFX_event_normal_frame_war
	desc = { 
		trigger = { 
			event_target:message_reader = {
				NOT = {
					character = ROOT
				}
			}
		} 
		text = EVTDESCATE_OW_REL5A
	}
	desc = {
		trigger = {
			event_target:message_reader = {
				character = ROOT
			}
		}
		text = EVTDESCATE_OW_REL5B
	}
	is_triggered_only = yes
	show_from_from = yes
	option = {
		trigger = { 
			event_target:message_reader = {
				NOT = {
					character = ROOT
				}
			}
		}
		name = EVTOPTAATE_OW_REL5
		event_target:message_reader = {
			piety = -1
		}
	}
	option = {
		trigger = { 
			event_target:message_reader = {
				character = ROOT
			}
		}
		name = EVTOPTBATE_OW_REL5
		piety = -1
	}
}
character_event = {
	id = ATE_OW_REL.6 
	
	picture = GFX_evt_beheading
	border = GFX_event_normal_frame_war
	desc = {
		trigger = {
			event_target:message_reader = {
				NOT = {
					character = ROOT
				}
			}
		}
		text = EVTDESCATE_OW_REL6A
	}
	desc = {
		trigger = {
			event_target:message_reader = {
				character = ROOT
			}
		}
		text = EVTDESCATE_OW_REL6B
	}
	immediate = {
		set_variable = { which = local_madame_liked value = 1.0 }
		random_list = {
			20 = {
				modifier = {
					factor = 0.2
					OR = {
						has_character_modifier = madame_wants_strong
						has_character_modifier = madame_wants_weak
					}
				}
				modifier = {
					factor = 0.6 # There is big overlap but they are rare traits
					OR = {
						has_character_modifier = madame_wants_attractive
						has_character_modifier = madame_wants_unattractive
					}
				}
				random_list = {
					1 = {
						set_variable = { which = local_madame_new_preference value = 1 }
						if = { limit = { FROMFROM = { is_strong_trigger = yes } } change_variable = { which = local_madame_liked value = 0.2 } }
						if = { limit = { FROMFROM = { is_weak_trigger = yes } } subtract_variable = { which = local_madame_liked value = 0.2 } }
					}
					1 = {
						set_variable = { which = local_madame_new_preference value = 2 }
						if = { limit = { FROMFROM = { is_weak_trigger = yes } } change_variable = { which = local_madame_liked value = 0.2 } }
						if = { limit = { FROMFROM = { is_strong_trigger = yes } } subtract_variable = { which = local_madame_liked value = 0.2 } }
					}
				}
				remove_character_modifier = madame_wants_strong
				remove_character_modifier = madame_wants_weak
			}
			20 = {
				modifier = {
					factor = 0.2
					OR = {
						has_character_modifier = madame_wants_smart
						has_character_modifier = madame_wants_dumb
					}
				}
				random_list = {
					1 = {
						set_variable = { which = local_madame_new_preference value = 3 }
						if = { limit = { FROMFROM = { is_smart_trigger = yes } } change_variable = { which = local_madame_liked value = 0.2 } }
						if = { limit = { FROMFROM = { is_dumb_trigger = yes } } subtract_variable = { which = local_madame_liked value = 0.2 } }
					}
					1 = {
						set_variable = { which = local_madame_new_preference value = 4 }
						if = { limit = { FROMFROM = { is_dumb_trigger = yes } } change_variable = { which = local_madame_liked value = 0.2 } }
						if = { limit = { FROMFROM = { is_smart_trigger = yes } } subtract_variable = { which = local_madame_liked value = 0.2 } }
					}
				}
				remove_character_modifier = madame_wants_smart
				remove_character_modifier = madame_wants_dumb
			}
			20 = {
				modifier = {
					factor = 0.2
					OR = {
						has_character_modifier = madame_wants_virtue
						has_character_modifier = madame_wants_vice
					}
				}
				random_list = {
					1 = {
						set_variable = { which = local_madame_new_preference value = 5 }
						if = { limit = { FROMFROM = { has_virtue_trigger = yes } } change_variable = { which = local_madame_liked value = 0.2 } }
						if = { limit = { FROMFROM = { has_vice_trigger = yes } } subtract_variable = { which = local_madame_liked value = 0.2 } }
					}
					1 = {
						set_variable = { which = local_madame_new_preference value = 6 }
						if = { limit = { FROMFROM = { has_vice_trigger = yes } } change_variable = { which = local_madame_liked value = 0.2 } }
						if = { limit = { FROMFROM = { has_virtue_trigger = yes } } subtract_variable = { which = local_madame_liked value = 0.2 } }
					}
				}
				remove_character_modifier = madame_wants_virtue
				remove_character_modifier = madame_wants_vice
			}
			20 = {
				modifier = {
					factor = 0.2
					OR = {
						has_character_modifier = madame_wants_attractive
						has_character_modifier = madame_wants_unattractive
					}
				}
				modifier = {
					factor = 0.75 # There is overlap
					OR = {
						has_character_modifier = madame_wants_strong
						has_character_modifier = madame_wants_weak
					}
				}
				random_list = {
					1 = {
						set_variable = { which = local_madame_new_preference value = 7 }
						if = { limit = { FROMFROM = { is_attractive_trigger = yes } } change_variable = { which = local_madame_liked value = 0.2 } }
						if = { limit = { FROMFROM = { is_unattractive_trigger = yes } } subtract_variable = { which = local_madame_liked value = 0.2 } }
					}
					1 = {
						set_variable = { which = local_madame_new_preference value = 8 }
						if = { limit = { FROMFROM = { is_unattractive_trigger = yes } } change_variable = { which = local_madame_liked value = 0.2 } }
						if = { limit = { FROMFROM = { is_attractive_trigger = yes } } subtract_variable = { which = local_madame_liked value = 0.2 } }
					}
				}
				remove_character_modifier = madame_wants_attractive
				remove_character_modifier = madame_wants_unattractive
			}
			10 = {
				modifier = {
					factor = 0.2
					OR = {
						has_character_modifier = madame_wants_martial
						has_character_modifier = madame_wants_diplomacy
						has_character_modifier = madame_wants_stewardship
					}
				}
				set_variable = { which = local_madame_new_preference value = 9 }
				if = { limit = { FROMFROM = { into_diplomacy_trigger = yes } } change_variable = { which = local_madame_liked value = 0.2 } }
				if = { limit = { FROMFROM = { into_stewardship_trigger = yes } } subtract_variable = { which = local_madame_liked value = 0.2 } }
				remove_character_modifier = madame_wants_martial
				remove_character_modifier = madame_wants_diplomacy
				remove_character_modifier = madame_wants_stewardship
			}
			10 = {
				modifier = {
					factor = 0.2
					OR = {
						has_character_modifier = madame_wants_learning
						has_character_modifier = madame_wants_martial
						has_character_modifier = madame_wants_diplomacy
					}
				}
				set_variable = { which = local_madame_new_preference value = 10 }
				if = { limit = { FROMFROM = { into_martial_trigger = yes } } change_variable = { which = local_madame_liked value = 0.2 } }
				if = { limit = { FROMFROM = { into_diplomacy_trigger = yes } } subtract_variable = { which = local_madame_liked value = 0.2 } }
				remove_character_modifier = madame_wants_martial
				remove_character_modifier = madame_wants_diplomacy
				remove_character_modifier = madame_wants_learning
			}
			10 = {
				modifier = {
					factor = 0.2
					OR = {
						has_character_modifier = madame_wants_intrigue
						has_character_modifier = madame_wants_learning
						has_character_modifier = madame_wants_martial
					}
				}
				set_variable = { which = local_madame_new_preference value = 11 }
				if = { limit = { FROMFROM = { into_learning_trigger = yes } } change_variable = { which = local_madame_liked value = 0.2 } }
				if = { limit = { FROMFROM = { into_martial_trigger = yes } } subtract_variable = { which = local_madame_liked value = 0.2 } }
				remove_character_modifier = madame_wants_martial
				remove_character_modifier = madame_wants_intrigue
				remove_character_modifier = madame_wants_learning
			}
			10 = {
				modifier = {
					factor = 0.2
					OR = {
						has_character_modifier = madame_wants_stewardship
						has_character_modifier = madame_wants_intrigue
						has_character_modifier = madame_wants_learning
					}
				}
				set_variable = { which = local_madame_new_preference value = 12 }
				if = { limit = { FROMFROM = { into_intrigue_trigger = yes } } change_variable = { which = local_madame_liked value = 0.2 } }
				if = { limit = { FROMFROM = { into_learning_trigger = yes } } subtract_variable = { which = local_madame_liked value = 0.2 } }
				remove_character_modifier = madame_wants_stewardship
				remove_character_modifier = madame_wants_intrigue
				remove_character_modifier = madame_wants_learning
			}
			10 = {
				modifier = {
					factor = 0.2
					OR = {
						has_character_modifier = madame_wants_diplomacy
						has_character_modifier = madame_wants_stewardship
						has_character_modifier = madame_wants_intrigue
					}
				}
				set_variable = { which = local_madame_new_preference value = 13 }
				if = { limit = { FROMFROM = { into_stewardship_trigger = yes } } change_variable = { which = local_madame_liked value = 0.2 } }
				if = { limit = { FROMFROM = { into_intrigue_trigger = yes } } subtract_variable = { which = local_madame_liked value = 0.2 } }
				remove_character_modifier = madame_wants_stewardship
				remove_character_modifier = madame_wants_intrigue
				remove_character_modifier = madame_wants_diplomacy
			}
		}
		if = {
			limit = {
				check_variable = { which = local_madame_liked value = 1.2 }
			}
			jacobinist_sacrifice_tiered_traits_effect = yes # Gave good sacrifice, might rank up
		}
	}
	is_triggered_only = yes
	show_from_from = yes
	option = {
		trigger = {
			event_target:message_reader = {
				NOT = {
					character = ROOT
				}
			}
			is_variable_equal = { which = local_madame_liked value = 1.0 }
		}
		name = EVTOPTAATE_OW_REL6 # Just gets modifier
		event_target:message_reader = {
			piety = 5
		}
		piety = 5
	}
	option = {
		trigger = {
			event_target:message_reader = {
				character = ROOT
			}
			is_variable_equal = { which = local_madame_liked value = 1.0 }
		}
		name = EVTOPTBATE_OW_REL6 # Just gets modifier
		piety = 10
	}
	option = {
		trigger = {
			event_target:message_reader = {
				NOT = {
					character = ROOT
				}
			}
			NOT = { check_variable = { which = local_madame_liked value = 1.0 } }
		}
		name = EVTOPTCATE_OW_REL6 # Gave bad sacrifice
		event_target:message_reader = {
			piety = -5
		}
		piety = -10
	}
	option = {
		trigger = {
			event_target:message_reader = {
				character = ROOT
			}
			NOT = { check_variable = { which = local_madame_liked value = 1.0 } }
		}
		name = EVTOPTDATE_OW_REL6 # Gave bad sacrifice
		piety = -15
	}
	option = {
		trigger = {
			event_target:message_reader = {
				NOT = {
					character = ROOT
				}
			}
			check_variable = { which = local_madame_liked value = 1.2 }
		}
		name = EVTOPTEATE_OW_REL6 # Gave good sacrifice
		event_target:message_reader = {
			piety = 10
		}
		piety = 30
	}
	option = {
		trigger = {
			event_target:message_reader = {
				character = ROOT
			}
			check_variable = { which = local_madame_liked value = 1.2 }
		}
		name = EVTOPTFATE_OW_REL6 # Gave good sacrifice
		piety = 40
	}
	after = {
		if = { limit = { is_variable_equal = { which = local_madame_new_preference value = 1 }  } add_character_modifier = { name = madame_wants_strong years = 5 } }
		else_if = { limit = { is_variable_equal = { which = local_madame_new_preference value = 2 }  } add_character_modifier = { name = madame_wants_weak years = 5 } }
		else_if = { limit = { is_variable_equal = { which = local_madame_new_preference value = 3 }  } add_character_modifier = { name = madame_wants_smart years = 5 } }
		else_if = { limit = { is_variable_equal = { which = local_madame_new_preference value = 4 }  } add_character_modifier = { name = madame_wants_dumb years = 5 } }
		else_if = { limit = { is_variable_equal = { which = local_madame_new_preference value = 5 }  } add_character_modifier = { name = madame_wants_virtue years = 5 } }
		else_if = { limit = { is_variable_equal = { which = local_madame_new_preference value = 6 }  } add_character_modifier = { name = madame_wants_vice years = 5 } }
		else_if = { limit = { is_variable_equal = { which = local_madame_new_preference value = 7 }  } add_character_modifier = { name = madame_wants_attractive years = 5 } }
		else_if = { limit = { is_variable_equal = { which = local_madame_new_preference value = 8 }  } add_character_modifier = { name = madame_wants_unattractive years = 5 } }
		else_if = { limit = { is_variable_equal = { which = local_madame_new_preference value = 9 }  } add_character_modifier = { name = madame_wants_diplomacy years = 5 } }
		else_if = { limit = { is_variable_equal = { which = local_madame_new_preference value = 10 }  } add_character_modifier = { name = madame_wants_martial years = 5 } }
		else_if = { limit = { is_variable_equal = { which = local_madame_new_preference value = 11 }  } add_character_modifier = { name = madame_wants_learning years = 5 } }
		else_if = { limit = { is_variable_equal = { which = local_madame_new_preference value = 12 }  } add_character_modifier = { name = madame_wants_intrigue years = 5 } }
		else_if = { limit = { is_variable_equal = { which = local_madame_new_preference value = 13 }  } add_character_modifier = { name = madame_wants_stewardship years = 5 } }
	}
	jacobinist_gain_tiered_traits_effect = yes
}