namespace=cleanup

character_event = { # Give Indian characters appropriate schools at game start
	id = cleanup.1
	hide_window = yes

	is_triggered_only = yes
	
	trigger = {
		OR = {
			religion = parabrahmanist
			religion = neovedantic
		}
		is_landed = yes#to keep it simple, we'll make all unlanded courtiers forcibly convert to the same school as their liege
		is_save_game = no#shouldn't happen when you reload a save
		NOR = {
			trait = shaivist_hindu
			trait = shaktist_hindu
			trait = vaishnavist_hindu
			trait = smartist_hindu
			trait = barata_ganda_hindu
			trait = savarkari_hindu
			trait = aryasamajist_hindu
			trait = vaishna_ganda_hindu
			trait = brahamo_hindu
			trait = ramakrishna_hindu
		}
	}
	immediate = {
		character_event = { id = RoI.30120 }
	}
}

character_event = {#sets the irish revolter with the irish_revolter character flag
	id = cleanup.4
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		primary_title = { title = k_irish_rebels }
		is_save_game = no
	}
	immediate = {
		set_character_flag = irish_revolter
		save_event_target_as = rebel_leader
	}
}
character_event = {#ensures each newly formed Oligarchic Republic has the Oligarchic Elective government
	id = cleanup.5
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		government = oligarchic_republic
		any_demesne_title = {
			NOR = {
				confederation_title_trigger = yes
				has_law = succ_oligarchic_elective
				has_law = succ_papal_succession
				has_law = succ_offmap_succession
				has_law = succ_byzantine_elective
			}
		}
	}
	immediate = {
		any_demesne_title = {
			limit = {
				NOR = {
					confederation_title_trigger = yes
					has_law = succ_oligarchic_elective
					has_law = succ_papal_succession
					has_law = succ_offmap_succession
					has_law = succ_byzantine_elective
				}
			}
			add_law = {
				law = succ_oligarchic_elective
				cooldown = no
				opinion_effect = no
			}
		}
	}
}
character_event = {#ensures each newly formed Oligarchic Republic has the Oligarchic Elective government
	id = cleanup.6
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		OR = {
			government = calvinist_government
			AND = {
				holy_order = yes
				government = order_government
			}
		}
		any_demesne_title = {
			NOR = {
				confederation_title_trigger = yes
				has_law = succ_monastic_elective
				has_law = succ_papal_succession
				has_law = succ_offmap_succession
				has_law = succ_byzantine_elective
			}
		}
	}
	immediate = {
		any_demesne_title = {
			limit = {
				NOR = {
					confederation_title_trigger = yes
					has_law = succ_monastic_elective
					has_law = succ_papal_succession
					has_law = succ_offmap_succession
					has_law = succ_byzantine_elective
				}
			}
			add_law = {
				law = succ_monastic_elective
				cooldown = no
				opinion_effect = no
			}
		}
	}
}
character_event = {
	id = cleanup.10
	desc = "DEBUG"
	hide_window = yes
	only_rulers = yes
	trigger = {
		NOT = { religion_group = jewish_group }
		has_earmarked_regiments = jewish_colony_troops
	}
	mean_time_to_happen = {
		days = 1
	}
	immediate = {
		disband_event_forces = jewish_colony_troops
	}
}
character_event = {
	id = cleanup.11
	religion_group = jewish_group
	#only_playable = yes
	hide_window = yes
	is_triggered_only = yes 
	ai = yes
	trigger = {
		OR = {
			AND = {
				is_save_game = no
				OR = {
					has_landed_title = c_tangiers
					has_landed_title = c_chandax
					has_landed_title = c_pantelleria
					has_landed_title = c_krk
					has_landed_title = c_ibiza
					has_landed_title = c_beni_yanni
					has_landed_title = c_goidheo
				}
			}
			FROM = {
				OR = {
					title = c_tangiers
					title = c_chandax
					title = c_pantelleria
					title = c_krk
					title = c_ibiza
					title = c_beni_yanni
					title = c_goidheo
				}
			}
		}
		NOT = { higher_tier_than = DUKE }
		NOT = { has_character_flag = ai_flag_refuse_conversion }
	}
	immediate = {
		set_character_flag = ai_flag_refuse_conversion
	}
}
character_event = {
	id = cleanup.12
	desc = cleanup12Desc
	picture = "GFX_evt_emissary"
	only_playable = yes
	mean_time_to_happen = {
		days = 1
	}
	trigger = {
		any_demesne_title = {
			has_title_flag = cypriote_member_state
		}
		rebel = no
		war = no
		OR = {
			any_demesne_title = {
				count = 2
				tier = DUKE
			}
			any_demesne_title = {
				higher_tier_than = DUKE
			}
			AND = {
				NOT = { has_landed_title = k_cyprus_league }
				OR = {
					liege = {
						NOT = { has_landed_title = k_cyprus_league }
						rebel = no
						primary_title = {
							temporary = no
						}
					}
					independent = yes
				}
			}
		}
	}
	option = {
		name = cleanup12Opt
		if = {
			limit = {
				any_demesne_title = {
					count = 2
					has_title_flag = cypriote_member_state
				}
			}
			random_demesne_title = {
				limit = { has_title_flag = cypriote_member_state }
				preferred_limit = {
					NOT = {
						ROOT = {
							primary_title = {
								title = PREVPREV
							}
						}
					}
				}
				unsafe_destroy_landed_title = THIS
				activate_title = { title = THIS status = no }
				character_event = { id = cleanup.11 }
			}
		}
		else = {
			any_demesne_title = {
				limit = { has_title_flag = cypriote_member_state }
				unsafe_destroy_landed_title = THIS
				activate_title = { title = THIS status = no }
			}
		}
	}
}
character_event = {
	id = cleanup.13
	
	hide_window = yes
	
	is_triggered_only = yes
	
	ai = no
	
	trigger = {
		current_heir = {
			NOT = {
				dynasty = ROOT
			}
		}
		OR = {
			has_game_rule = {
				name = non_dynastic_succession
				value = on
			}
			AND = {
				has_game_rule = {
					name = non_dynastic_succession
					value = limited
				}
				government = oligarchic_republic
			}
		}
		NOT = { holy_order = yes }
	}
	
	immediate = {
		current_heir = {
			ROOT = { set_player_character = PREV }
		}
	}
}
character_event = {
	id = cleanup.14
	
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		government = order_government
		holy_order = yes
	}
	
	immediate = {
		if = {
			limit = {
				ai = no
				has_game_rule = {
					name = non_dynastic_succession
					value = off
				}
				current_heir = {
					NOT = {
						dynasty = ROOT
					}
				}
			}
			random_demesne_title = {
				limit = {
					NOT = {
						location = {
							ROOT = {
								capital_scope = {
									province = PREVPREV
								}
							}
						}
					}
				}
				ROOT = {
					random_dynasty_member = {
						limit = {
							religion = ROOT
							OR = {
								is_ruler = no
								vassal_of = ROOT
							}
						}
						preferred_limit = {
							vassal_of = ROOT
							is_close_relative = ROOT
						}
						preferred_limit = {
							vassal_of = ROOT
						}
						preferred_limit = {
							is_close_relative = ROOT
						}
						grant_title_no_opinion = PREVPREV
						ROOT = { set_player_character = PREV }
					}
				}
			}
		}
		current_heir = {
			wealth = ROOT
			ROOT = {
				if = {
					limit = {
						ai = no
						NOT = {
							has_game_rule = {
								name = non_dynastic_succession
								value = off
							}
						}
					}
					set_player_character = PREV
				}
				abdicate_to = PREV
				clear_wealth = yes
				any_artifact = {
					transfer_artifact = { from = ROOT to = PREVPREV }
				}
			}
		}
	}
}
character_event = {
	id = cleanup.15
	
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		FROMFROM = {
			has_character_flag = horde_invader
			primary_title = { title = ROOT_FROM }
		}
	}
	immediate = {
		random = {
			chance = 90
			set_character_flag = horde_invader # 90% to pass on this flag
		}
	}
}

character_event = {
	id = cleanup.16
	
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		graphical_culture = robotgfx
		NOT = { trait = android }
	}
	immediate = {
		add_trait = android
	}
}
character_event = {
	id = cleanup.17
	hide_window = yes	
	min_age = 16
	capable_only = yes
	
	trigger = {
		religion = catholic
		OR = {
			government = theocracy_government
			has_job_title = job_spiritual
		}
	}
	
	immediate={
	}
	option = {
		name = "EVTOPTA_cleanup.17"
		if = {
			limit = {
				OR = {
					culture_group = celtic
					culture_group = brittannic
					culture = westlander
					culture = eastlander
					culture = northlander
					culture = old_norman
					culture = ulsterite
				}
			}
			add_trait = celtic_rite
		}
		else_if = {
			limit = {
				OR = {
					culture_group = byzantine
					culture_group = transnistrian
					culture = bulgarian
					culture = serbian
					culture = montenegrin
					culture = rusyn
				}
			}
			add_trait = byzantine_rite
		}
		else_if = { 
			limit = {
				OR ={
					culture_group = hispanophone
					culture_group = lusophone
					culture_group = basque
					culture = llanito
				}
			}
			add_trait = iberian_rite
		}
		else_if = {
			limit = {
				culture_group = arabic
			}
			add_trait = maronite_rite
		}
		else_if = { 
			limit = {
				OR ={
					culture_group = dravidian_group
					culture_group = indo_aryan_group
					culture_group = tibetan_group
					culture = angrezi
				}
			}
			add_trait = indian_rite
		}
		else_if = {
			limit = {
				culture_group = caucasian
			}
			add_trait = armenian_rite
		}
		else_if = {
			limit = {
				OR = {
					culture = assyrian
					culture = babylonian
				}
			}
			add_trait = aremaic_rite
		}
		else_if = {
			limit = {
				OR = {
					culture_group = east_slavic
					culture_group = central_slavic
				}
				NOT = {
					culture = rusyn
				}
			}
			add_trait = slavic_rite
		}
		
		else = { # happens if all of the statements before are fails
			add_trait = latin_rite
		}
	}
}
character_event = {
	id = cleanup.18
	
	hide_window = yes
	
	trigger = {
		primary_title = {
			landless = no
			temporary = no
		}
		trait = peasant_leader
		trait = heresiarch
	}
	immediate = {
		remove_trait = peasant_leader
		remove_trait = heresiarch
		add_trait = peasant_noble
	}
}

character_event = {
	id = cleanup.100
	is_triggered_only = yes
	hide_window = yes
	hide_from = yes

	religion = catholic
	only_playable = yes
	min_age = 16

	trigger = {
		controls_religion = yes
	}
	immediate = {
		k_israel = {
			save_persistent_event_target = { name = muslim_title scope = k_palestine }
			save_persistent_event_target = { name = non_muslim_title scope = k_israel_history }
			persistent_event_target:non_muslim_title = {
				set_name = PREV
				copy_title_history = PREV
			}
		}
		if = {
			limit = {
				any_demesne_title = {
					has_title_flag = christian_title
				}
			}
			save_persistent_event_target = { name = muslim_title scope = k_palestine }
			save_persistent_event_target = { name = non_muslim_title scope = k_jerusalem_history }
			persistent_event_target:non_muslim_title = {
				set_name = PREV
				copy_title_history = PREV
			}
		}
	}
}

character_event = {
	id = cleanup.101
	is_triggered_only = yes
	hide_window = yes
	hide_from = yes
	
	trigger = {
		FROM = { muslim_switch_trigger = yes }
	}
	
	immediate = {
		FROM = { muslim_switch_effect = yes }
	}
}

character_event = {
	id = cleanup.102
	is_triggered_only = yes
	hide_window = yes
	hide_from = yes
	only_playable = yes
	
	trigger = {
		any_demesne_title = {
			muslim_switch_trigger = yes
		}
	}
	
	immediate = {
		any_demesne_title = {
			muslim_switch_effect = yes
		}
	}
}

character_event = {
	id = cleanup.103
	is_triggered_only = yes
	hide_window = yes
	hide_from = yes

	religion = catholic
	only_playable = yes
	min_age = 16

	trigger = {
		controls_religion = yes
	}
	immediate = {
		k_palestine = {
			save_persistent_event_target = { name = jewish_title scope = k_israel }
			save_persistent_event_target = { name = non_jewish_title scope = k_palestine_history }
			persistent_event_target:non_jewish_title = {
				set_name = PREV
				copy_title_history = PREV
			}
		}
		k_jerusalem = {
			save_persistent_event_target = { name = jewish_title scope = k_israel }
			save_persistent_event_target = { name = non_jewish_title scope = k_jerusalem_history }
			persistent_event_target:non_jewish_title = {
				set_name = PREV
				copy_title_history = PREV
			}
		}
	}
}

character_event = {
	id = cleanup.104
	is_triggered_only = yes
	hide_window = yes
	hide_from = yes
	
	trigger = {
		FROM = { jewish_switch_trigger = yes }
	}
	
	immediate = {
		FROM = { jewish_switch_effect = yes }
	}
}

character_event = {
	id = cleanup.105
	is_triggered_only = yes
	hide_window = yes
	hide_from = yes
	only_playable = yes
	
	trigger = {
		any_demesne_title = {
			jewish_switch_trigger = yes
		}
	}
	
	immediate = {
		any_demesne_title = {
			jewish_switch_effect = yes
		}
	}
}

character_event = {
	id = cleanup.106
	is_triggered_only = yes
	hide_window = yes
	hide_from = yes

	religion = catholic
	only_playable = yes
	min_age = 16

	trigger = {
		controls_religion = yes
	}
	immediate = {
		k_israel = {
			save_persistent_event_target = { name = christian_title scope = k_jerusalem }
			save_persistent_event_target = { name = non_christian_title scope = k_israel_history }
			persistent_event_target:non_christian_title = {
				set_name = PREV
				copy_title_history = PREV
			}
		}
		if = {
			limit = {
				any_demesne_title = {
					has_title_flag = muslim_title
				}
			}
			save_persistent_event_target = { name = christian_title scope = k_jerusalem }
			save_persistent_event_target = { name = non_christian_title scope = k_palestine_history }
			persistent_event_target:non_christian_title = {
				set_name = PREV
				copy_title_history = PREV
			}
		}
	}
}

character_event = {
	id = cleanup.107
	is_triggered_only = yes
	hide_window = yes
	hide_from = yes
	
	trigger = {
		FROM = { christian_switch_trigger = yes }
	}
	
	immediate = {
		FROM = { christian_switch_effect = yes }
	}
}

character_event = {
	id = cleanup.108
	is_triggered_only = yes
	hide_window = yes
	hide_from = yes
	only_playable = yes
	
	trigger = {
		any_demesne_title = {
			christian_switch_trigger = yes
		}
	}
	
	immediate = {
		any_demesne_title = {
			christian_switch_effect = yes
		}
	}
}
character_event = {
	id = cleanup.109
	is_triggered_only = yes
	hide_window = yes
	hide_from = yes
	
	trigger = {
		dynasty = 4031013
		is_female = no
		NOT = {
			has_nickname = nick_hereward
		}
	}
	
	immediate = {
		give_nickname = nick_hereward
	}
}


narrative_event = { # Robots
	id = cleanup.9000
	
	desc = cleanup9000Desc
	title = cleanup9000Title
	show_portrait = e_droid
	picture = GFX_evt_comet
	border = GFX_event_narrative_frame_religion
	is_triggered_only = yes
	
	immediate = {
		random_province = {
			limit = {
				is_land = yes
			}
			save_global_event_target_as = spawn_robot_province
			holder_scope = {
				save_global_event_target_as = spawn_robot_target
			}
			kingdom = {
				save_global_event_target_as = spawn_robot_kingdom
			}
			create_character = {
				name = "000"
				random_traits = yes
				age = 16
				culture = android
				dynasty = 1995000
				religion = purge
			}
			new_character = {
				save_global_event_target_as = invasion_leader
				remove_education_effect = yes
				add_trait = brilliant_strategist
				add_trait = android
				remove_disease_trait_effect = yes
				clear_disease_level_effect = yes
				remove_disease_flags_effect = yes
				remove_all_negative_congenital_traits_effect = yes
				e_droid = {
					activate_title = {
						title = THIS
						status = yes
					}
					grant_title = ROOT
					add_law = ze_administration_laws_2
					add_law = revoke_title_law_2
					add_law = vassal_wars_law_2
					add_law = vice_royalty_2
					add_law = status_of_women_4
					add_law = succ_primogeniture
				}
				grant_title = e_droid
				wealth = 50000
				prestige = 20000
				spawn_fantastic_commander_effect = yes
				spawn_fantastic_commander_effect = yes
				spawn_fantastic_commander_effect = yes
				spawn_fantastic_commander_effect = yes
				spawn_fantastic_commander_effect = yes
				spawn_fantastic_commander_effect = yes
				spawn_fantastic_commander_effect = yes
				spawn_fantastic_commander_effect = yes
				spawn_fantastic_diplomat_effect = yes
				spawn_fantastic_diplomat_effect = yes
				spawn_fantastic_scholar_effect = yes
				spawn_fantastic_scholar_effect = yes
				spawn_robot_army = yes
				spawn_robot_army = yes
				spawn_robot_army = yes
				spawn_robot_army = yes
				unsafe_war = {
					target = event_target:spawn_robot_target
					casus_belli = tribal_invasion
					thirdparty_title = event_target:spawn_robot_kingdom
				}
			}
		}
	}
	option = {
		name = cleanup9000OptA
	}
	option = {
		name = cleanup9000OptB
		tooltip_info = yes
		trigger = {
			can_plays_as_invader_trigger = yes
		}
		play_as_invasion_leader_effect = yes
	}
}
character_event = {
	id = cleanup.19
	is_triggered_only = yes
	picture = GFX_evt_book_carolingian_script
	border = GFX_event_normal_frame_religion
	title = EVTNAME_cleanup.19
	desc = EVTDESC_cleanup.19	

	hide_from = yes

	immediate = {
		set_character_flag = picking_anglican_branch
	}
	
	option = {
		name = EVTOPTA_cleanup.19
		add_trait = high_anglican
	}
	
	option = {
		name = EVTOPTB_cleanup.19
		add_trait = broad_anglican
	}
	
	option = {
		name = EVTOPTC_cleanup.19
		add_trait = low_anglican
	}
	
	after = {
		clr_character_flag = picking_anglican_branch
	}
}

letter_event = {
	id = cleanup.20
	is_triggered_only = yes
	border = GFX_event_letter_frame_religion
	desc = cleanup.20Desc
	option = {
		name = EVTOPTA_cleanup.20
		random_list = {
			10 = {
				modifier = {
					factor = 2
					OR = {
						father_even_if_dead = {
							trait = high_anglican
						}
						mother_even_if_dead = {
							trait = high_anglican
						}
					}
				}
				modifier = {
					factor = 1.5
					OR = {
						father_even_if_dead = {
							OR = {
								father_even_if_dead = {
									trait = high_anglican
								}
								mother_even_if_dead = {
									trait = high_anglican
								}
							}
						}
						mother_even_if_dead = {
							OR = {
								father_even_if_dead = {
									trait = high_anglican
								}
								mother_even_if_dead = {
									trait = high_anglican
								}
							}
						}
					}
				}
				job_event_mtth_modifier_inverted_diplomacy_score = yes
				add_trait = high_anglican
			}
			10 = {
				modifier = {
					factor = 2
					OR = {
						father_even_if_dead = {
							trait = broad_anglican
						}
						mother_even_if_dead = {
							trait = broad_anglican
						}
					}
				}
				modifier = {
					factor = 1.5
					OR = {
						father_even_if_dead = {
							OR = {
								father_even_if_dead = {
									trait = broad_anglican
								}
								mother_even_if_dead = {
									trait = broad_anglican
								}
							}
						}
						mother_even_if_dead = {
							OR = {
								father_even_if_dead = {
									trait = broad_anglican
								}
								mother_even_if_dead = {
									trait = broad_anglican
								}
							}
						}
					}
				}
				job_event_mtth_modifier_inverted_martial_score = yes
				add_trait = broad_anglican
			}
			10 = {
				modifier = {
					factor = 2
					OR = {
						father_even_if_dead = {
							trait = low_anglican
						}
						mother_even_if_dead = {
							trait = low_anglican
						}
					}
				}
				modifier = {
					factor = 1.5
					OR = {
						father_even_if_dead = {
							OR = {
								father_even_if_dead = {
									trait = low_anglican
								}
								mother_even_if_dead = {
									trait = low_anglican
								}
							}
						}
						mother_even_if_dead = {
							OR = {
								father_even_if_dead = {
									trait = low_anglican
								}
								mother_even_if_dead = {
									trait = low_anglican
								}
							}
						}
					}
				}
				job_event_mtth_modifier_inverted_stewardship_score = yes
				add_trait = low_anglican
			}
		}
	}
	after = {
		clr_character_flag = picking_anglican_branch
	}
}