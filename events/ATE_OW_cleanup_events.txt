namespace=cleanup

character_event = { # Give Indian characters appropriate schools at game start
	id = cleanup.1
	hide_window = yes

	is_triggered_only = yes
	
	trigger = {
		OR = {
			religion = bharatva
			religion = neovedantic
		}
		is_landed = yes#to keep it simple, we'll make all unlanded courtiers forcibly convert to the same school as their liege
		is_save_game = no#shouldn't happen when you reload a save
		NOR = {
			trait = shaivist_hindu
			trait = shaktist_hindu
			trait = vaishnavist_hindu
			trait = smartist_hindu
			trait = barata_ganda_hindu
			trait = savarkari_hindu
			trait = aryasamajist_hindu
			trait = vaishna_ganda_hindu
			trait = brahamo_hindu
			trait = ramakrishna_hindu
		}
	}
	immediate = {
		character_event = { id = RoI.30120 }
	}
}

character_event = {#sets the irish revolter with the irish_revolter character flag
	id = cleanup.4
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		primary_title = { title = k_irish_rebels }
		is_save_game = no
	}
	immediate = {
		set_character_flag = irish_revolter
		save_event_target_as = rebel_leader
	}
}
character_event = {#ensures each newly formed Oligarchic Republic has the Oligarchic Elective government
	id = cleanup.5
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		government = oligarchic_republic
		any_demesne_title = {
			NOR = {
				confederation_title_trigger = yes
				has_law = succ_oligarchic_elective
				has_law = succ_papal_succession
				has_law = succ_offmap_succession
				has_law = succ_byzantine_elective
			}
		}
	}
	immediate = {
		any_demesne_title = {
			limit = {
				NOR = {
					confederation_title_trigger = yes
					has_law = succ_oligarchic_elective
					has_law = succ_papal_succession
					has_law = succ_offmap_succession
					has_law = succ_byzantine_elective
				}
			}
			add_law = {
				law = succ_oligarchic_elective
				cooldown = no
				opinion_effect = no
			}
		}
	}
}
character_event = {#ensures each newly formed Oligarchic Republic has the Oligarchic Elective government
	id = cleanup.6
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		OR = {
			government = calvinist_government
			AND = {
				holy_order = yes
				government = order_government
			}
		}
		any_demesne_title = {
			NOR = {
				confederation_title_trigger = yes
				has_law = succ_monastic_elective
				has_law = succ_papal_succession
				has_law = succ_offmap_succession
				has_law = succ_byzantine_elective
			}
		}
	}
	immediate = {
		any_demesne_title = {
			limit = {
				NOR = {
					confederation_title_trigger = yes
					has_law = succ_monastic_elective
					has_law = succ_papal_succession
					has_law = succ_offmap_succession
					has_law = succ_byzantine_elective
				}
			}
			add_law = {
				law = succ_monastic_elective
				cooldown = no
				opinion_effect = no
			}
		}
	}
}
character_event = {
	id = cleanup.10
	desc = "DEBUG"
	hide_window = yes
	only_rulers = yes
	trigger = {
		NOT = { religion_group = jewish_group }
		has_earmarked_regiments = jewish_colony_troops
	}
	mean_time_to_happen = {
		days = 1
	}
	immediate = {
		disband_event_forces = jewish_colony_troops
	}
}
character_event = {
	id = cleanup.11
	religion_group = jewish_group
	#only_playable = yes
	hide_window = yes
	is_triggered_only = yes 
	ai = yes
	trigger = {
		OR = {
			AND = {
				is_save_game = no
				OR = {
					has_landed_title = c_tangiers
					has_landed_title = c_chandax
					has_landed_title = c_pantelleria
					has_landed_title = c_krk
					has_landed_title = c_ibiza
					has_landed_title = c_beni_yanni
					has_landed_title = c_goidheo
				}
			}
			FROM = {
				OR = {
					title = c_tangiers
					title = c_chandax
					title = c_pantelleria
					title = c_krk
					title = c_ibiza
					title = c_beni_yanni
					title = c_goidheo
				}
			}
		}
		NOT = { higher_tier_than = DUKE }
		NOT = { has_character_flag = ai_flag_refuse_conversion }
	}
	immediate = {
		set_character_flag = ai_flag_refuse_conversion
	}
}
character_event = {
	id = cleanup.12
	desc = cleanup12Desc
	picture = "GFX_evt_emissary"
	only_playable = yes
	mean_time_to_happen = {
		days = 1
	}
	trigger = {
		any_demesne_title = {
			has_title_flag = cypriote_member_state
		}
		rebel = no
		war = no
		OR = {
			any_demesne_title = {
				count = 2
				tier = DUKE
			}
			any_demesne_title = {
				higher_tier_than = DUKE
			}
			AND = {
				NOT = { has_landed_title = k_cyprus_league }
				OR = {
					liege = {
						NOT = { has_landed_title = k_cyprus_league }
						rebel = no
						primary_title = {
							temporary = no
						}
					}
					independent = yes
				}
			}
		}
	}
	option = {
		name = cleanup12Opt
		if = {
			limit = {
				any_demesne_title = {
					count = 2
					has_title_flag = cypriote_member_state
				}
			}
			random_demesne_title = {
				limit = { has_title_flag = cypriote_member_state }
				preferred_limit = {
					NOT = {
						ROOT = {
							primary_title = {
								title = PREVPREV
							}
						}
					}
				}
				unsafe_destroy_landed_title = THIS
				activate_title = { title = THIS status = no }
				character_event = { id = cleanup.11 }
			}
		}
		else = {
			any_demesne_title = {
				limit = { has_title_flag = cypriote_member_state }
				unsafe_destroy_landed_title = THIS
				activate_title = { title = THIS status = no }
			}
		}
	}
}
character_event = {
	id = cleanup.13
	
	hide_window = yes
	
	is_triggered_only = yes
	
	ai = no
	
	trigger = {
		current_heir = {
			NOT = {
				dynasty = ROOT
			}
		}
		OR = {
			has_game_rule = {
				name = non_dynastic_succession
				value = on
			}
			AND = {
				has_game_rule = {
					name = non_dynastic_succession
					value = limited
				}
				government = oligarchic_republic
			}
		}
		NOT = { holy_order = yes }
	}
	
	immediate = {
		current_heir = {
			ROOT = { set_player_character = PREV }
		}
	}
}
character_event = {
	id = cleanup.14
	
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		government = order_government
		holy_order = yes
	}
	
	immediate = {
		if = {
			limit = {
				ai = no
				has_game_rule = {
					name = non_dynastic_succession
					value = off
				}
				current_heir = {
					NOT = {
						dynasty = ROOT
					}
				}
			}
			random_demesne_title = {
				limit = {
					NOT = {
						location = {
							ROOT = {
								capital_scope = {
									province = PREVPREV
								}
							}
						}
					}
				}
				ROOT = {
					random_dynasty_member = {
						limit = {
							religion = ROOT
							OR = {
								is_ruler = no
								vassal_of = ROOT
							}
						}
						preferred_limit = {
							vassal_of = ROOT
							is_close_relative = ROOT
						}
						preferred_limit = {
							vassal_of = ROOT
						}
						preferred_limit = {
							is_close_relative = ROOT
						}
						grant_title_no_opinion = PREVPREV
						ROOT = { set_player_character = PREV }
					}
				}
			}
		}
		current_heir = {
			wealth = ROOT
			ROOT = {
				if = {
					limit = {
						ai = no
						NOT = {
							has_game_rule = {
								name = non_dynastic_succession
								value = off
							}
						}
					}
					set_player_character = PREV
				}
				abdicate_to = PREV
				clear_wealth = yes
				any_artifact = {
					transfer_artifact = { from = ROOT to = PREVPREV }
				}
			}
		}
	}
}
character_event = {
	id = cleanup.15
	
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		FROMFROM = {
			has_character_flag = horde_invader
			primary_title = { title = ROOT_FROM }
		}
	}
	immediate = {
		random = {
			chance = 90
			set_character_flag = horde_invader # 90% to pass on this flag
		}
	}
}