namespace = thelema


character_event = {
	id = thelema.1000
	is_triggered_only = yes
	trigger = {
		allowed_to_use_stele_trigger = yes
	}
	fail_trigger_effect = {
		character_event = { id = thelema.1003 }
	}
	picture = GFX_evt_runestone_raising_oldgods
	border = GFX_event_normal_frame_religion
	desc = EVTDESCTHELEMA1000
	option = {
		name = EVTOPTTHELEMA1000A
		scaled_wealth = {
			value = -0.5
			min = -25
			max = -501
		}
		character_event = { id = thelema.1001 tooltip = EVTOPTTHELEMA1000A_tooltip }
		set_character_flag = stele_cost_0
		ai_chance = {
			factor = 10
		}
	}
	option = {
		name = EVTOPTTHELEMA1000B
		scaled_wealth = {
			value = -1
			min = -50
			max = -1002
		}
		character_event = { id = thelema.1001 tooltip = EVTOPTTHELEMA1000B_tooltip }
		set_character_flag = stele_cost_1
		ai_chance = {
			factor = 30
			modifier = {
				factor = 0
				NOT = {
					scaled_wealth = {
						value = 1
						min = 50
						max = 1002
					}
				}
			}
		}
	}
	option = {
		name = EVTOPTTHELEMA1000C
		trigger = {
			NOT = { religion = thelemic }
		}
		scaled_wealth = {
			value = -1.5
			min = -75
			max = -1503
		}
		character_event = { id = thelema.1001 tooltip = EVTOPTTHELEMA1000C_tooltip }
		set_character_flag = stele_cost_2
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				NOT = {
					scaled_wealth = {
						value = 1.5
						min = 75
						max = 1503
					}
				}
			}
		}
	}
	option = {
		name = EVTOPTTHELEMA1000D
		remove_character_modifier = erecting_stele
		ai_chance = {
			factor = 0
		}
	}
}

character_event = {
	id = thelema.1001
	is_triggered_only = yes
	trigger = {
		allowed_to_use_stele_trigger = yes
	}
	fail_trigger_effect = {
		character_event = { id = thelema.1003 }
	}
	picture = GFX_evt_runestone_raising_oldgods
	border = GFX_event_normal_frame_religion
	desc = EVTDESCTHELEMA1001
	immediate = {
		set_variable = {
			which = needed_stele_targets
			value = 4
		}
		while = {
			limit = {
				check_variable = {
					which = needed_stele_targets
					value >= 1
				}
			}
			subtract_variable = {
				which = needed_stele_targets
				value = 1
			}
			random_list = {
				200 = {
					trigger = {
						NOT = { event_target:stele_self = { always = yes } }
					}
					modifier = {
						factor = 0.2
						trait = humble
					}
					modifier = {
						factor = 2
						trait = proud
					}
					save_event_target_as = stele_self
				}
				100 = {
					trigger = {
						NOT = { event_target:stele_father = { always = yes } }
						father_even_if_dead = { NOT = { is_rival = ROOT } }
					}
					modifier = {
						factor = 0.2
						is_equalist_religion = no
						is_feminist_religion = yes
					}
					modifier = {
						factor = 0.5
						OR = {
							is_feminist_culture = yes
							is_feminist_religion = yes
						}
					}
					father_even_if_dead = { save_event_target_as = stele_father }
				}
				10 = {
					trigger = {
						NOT = { event_target:stele_mother = { always = yes } }
						mother_even_if_dead = { NOT = { is_rival = ROOT } }
					}
					modifier = {
						factor = 2
						is_feminist_religion = yes
						is_equalist_religion = no
					}
					modifier = {
						factor = 5
						OR = {
							is_feminist_culture = yes
							is_feminist_religion = yes
						}
					}
					mother_even_if_dead = { save_event_target_as = stele_mother }
				}
				70 = {
					trigger = {
						NOT = { event_target:stele_grand_father = { always = yes } }
						OR = {
							father_even_if_dead = { father_even_if_dead = { NOT = { is_rival = ROOT } } }
							mother_even_if_dead = { father_even_if_dead = { NOT = { is_rival = ROOT } } }
						}
					}
					modifier = {
						factor = 0.2
						is_equalist_religion = no
						is_feminist_religion = yes
					}
					modifier = {
						factor = 0.5
						OR = {
							is_feminist_culture = yes
							is_feminist_religion = yes
						}
					}
					random_list = {
						10 = {
							trigger = { father_even_if_dead = { father_even_if_dead = { NOT = { is_rival = ROOT } } } }
							father_even_if_dead = { father_even_if_dead = { save_event_target_as = stele_grand_father } }
						}
						10 = {
							trigger = { mother_even_if_dead = { father_even_if_dead = { NOT = { is_rival = ROOT } } } }
							mother_even_if_dead = { father_even_if_dead = { save_event_target_as = stele_grand_father } }
						}
					}
				}
				7 = {
					trigger = {
						NOT = { event_target:stele_grand_mother = { always = yes } }
						OR = {
							father_even_if_dead = { mother_even_if_dead = { NOT = { is_rival = ROOT } } }
							mother_even_if_dead = { mother_even_if_dead = { NOT = { is_rival = ROOT } } }
						}
					}
					modifier = {
						factor = 2
						is_feminist_religion = yes
						is_equalist_religion = no
					}
					modifier = {
						factor = 5
						OR = {
							is_feminist_culture = yes
							is_feminist_religion = yes
						}
					}
					random_list = {
						10 = {
							trigger = { father_even_if_dead = { mother_even_if_dead = { NOT = { is_rival = ROOT } } } }
							father_even_if_dead = { mother_even_if_dead = { save_event_target_as = stele_grand_mother } }
						}
						10 = {
							trigger = { mother_even_if_dead = { mother_even_if_dead = { NOT = { is_rival = ROOT } } } }
							mother_even_if_dead = { mother_even_if_dead = { save_event_target_as = stele_grand_mother } }
						}
					}
				}
				50 = {
					trigger = {
						NOT = { event_target:stele_sibling = { always = yes } }
						any_sibling_even_if_dead = { NOT = { is_rival = ROOT } }
					}
					modifier = {
						factor = 2
						any_sibling_even_if_dead = {
							count >= 3
							always = yes
						}
					}
					random_sibling_even_if_dead = { save_event_target_as = stele_sibling }
				}
				50 = {
					trigger = {
						NOT = { event_target:stele_friend = { always = yes } }
						any_friend = { always = yes }
					}
					modifier = {
						factor = 2
						any_friend = {
							count >= 2
							always = yes
						}
					}
					random_friend = { save_event_target_as = stele_friend }
				}
				50 = {
					trigger = {
						NOT = { event_target:stele_lover = { always = yes } }
						any_lover = {
							NOR = {
								any_spouse = {
									character = ROOT
								}
								any_consort = {
									character = ROOT
								}
							}
						}
					}
					modifier = {
						factor = 2
						any_lover = {
							count >= 2
							NOR = {
								any_spouse = {
									character = ROOT
								}
								any_consort = {
									character = ROOT
								}
							}
						}
					}
					random_lover = {
						limit = {
							NOR = {
								any_spouse = {
									character = ROOT
								}
								any_consort = {
									character = ROOT
								}
							}
						}
						save_event_target_as = stele_lover
					}
				}
				30 = {
					trigger = {
						NOT = { event_target:stele_spouse = { always = yes } }
						OR = {
							any_spouse = {
								NOT = { is_rival = ROOT }
							}
							any_consort = {
								NOT = { is_rival = ROOT }
							}
						}
					}
					modifier = {
						factor = 3
						OR = {
							any_spouse = {
								is_lover = ROOT
							}
							any_consort = {
								is_lover = ROOT
							}
						}
					}
					if = {
						limit = {
							any_consort = {
								is_lover = ROOT
							}
							NOT = {
								any_spouse = {
									is_lover = ROOT
								}
							}
						}
						random_consort = {
							limit = {
								is_lover = ROOT
							}
							save_event_target_as = stele_spouse
						}
					}
					else_if = {
						limit = {
							any_spouse = {
								NOT = { is_rival = ROOT }
							}
						}
						random_spouse = {
							limit = {
								NOT = { is_rival = ROOT }
							}
							preferred_limit = {
								is_lover = ROOT
							}
							save_event_target_as = stele_spouse
						}
					}
					else = {
						random_consort = {
							limit = {
								NOT = { is_rival = ROOT }
							}
							save_event_target_as = stele_spouse
						}
					}
				}
				30 = {
					trigger = {
						NOT = { event_target:stele_rival = { always = yes } }
						any_rival = { always = yes }
					}
					modifier = {
						factor = 2
						any_rival = {
							count >= 2
							always = yes
						}
					}
					modifier = {
						factor = 3
						trait = wroth
					}
					modifier = {
						factor = 0.2
						trait = patient
					}
					random_rival = { save_event_target_as = stele_rival }
				}
				fallback = {
					set_variable = {
						which = needed_stele_targets
						value = 0
					}
				}
			}
		}
	}
	option = {
		name = EVTOPTTHELEMA1001A
		trigger = {
			event_target:stele_self = { always = yes }
		}
		save_persistent_event_target = { name = stele_target scope = event_target:stele_self }
	}
	option = {
		name = EVTOPTTHELEMA1001B
		trigger = {
			event_target:stele_father = { always = yes }
		}
		save_persistent_event_target = { name = stele_target scope = event_target:stele_father }
	}
	option = {
		name = EVTOPTTHELEMA1001C
		trigger = {
			event_target:stele_mother = { always = yes }
		}
		save_persistent_event_target = { name = stele_target scope = event_target:stele_mother }
	}
	option = {
		name = EVTOPTTHELEMA1001D
		trigger = {
			event_target:stele_grand_father = { always = yes }
		}
		save_persistent_event_target = { name = stele_target scope = event_target:stele_grand_father }
	}
	option = {
		name = EVTOPTTHELEMA1001E
		trigger = {
			event_target:stele_grand_mother = { always = yes }
		}
		save_persistent_event_target = { name = stele_target scope = event_target:stele_grand_mother }
	}
	option = {
		name = EVTOPTTHELEMA1001F
		trigger = {
			event_target:stele_sibling = { always = yes }
		}
		save_persistent_event_target = { name = stele_target scope = event_target:stele_sibling }
	}
	option = {
		name = EVTOPTTHELEMA1001G
		trigger = {
			event_target:stele_friend = { always = yes }
		}
		save_persistent_event_target = { name = stele_target scope = event_target:stele_friend }
	}
	option = {
		name = EVTOPTTHELEMA1001H
		trigger = {
			event_target:stele_lover = { always = yes }
		}
		save_persistent_event_target = { name = stele_target scope = event_target:stele_lover }
		
		if = {
			limit = { 
				OR = {
					AND = {
						event_target:stele_lover = { 
							female = no 
							
						}
						female = no
					}
					AND = {
						event_target:stele_lover = { 
							female = yes 
						}
						female = yes
					}
				}
			}
			event_target:stele_lover = { add_trait = bisexual }
			add_trait = bisexual
		}
	}
	option = {
		name = EVTOPTTHELEMA1001I
		trigger = {
			event_target:stele_spouse = { always = yes }
		}
		save_persistent_event_target = { name = stele_target scope = event_target:stele_spouse }
	}
	option = {
		name = EVTOPTTHELEMA1001J
		trigger = {
			event_target:stele_rival = { always = yes }
		}
		save_persistent_event_target = { name = stele_target scope = event_target:stele_rival }
	}
	after = {
		hidden_effect = {
			clear_event_target = stele_self
			clear_event_target = stele_father
			clear_event_target = stele_mother
			clear_event_target = stele_grand_father
			clear_event_target = stele_grand_mother
			clear_event_target = stele_sibling
			clear_event_target = stele_friend
			clear_event_target = stele_lover
			clear_event_target = stele_spouse
			clear_event_target = stele_rival
			set_variable = {
				which = stele_progress
				value = 0
			}
			set_variable = {
				which = stele_extra_quality
				value = 0
			}
			character_event = { id = thelema.1002 days = 182 }
		}
	}
}

character_event = {
	id = thelema.1002
	is_triggered_only = yes
	hide_window = yes
	trigger = {
		allowed_to_use_stele_trigger = yes
	}
	fail_trigger_effect = {
		character_event = { id = thelema.1003 }
	}
	immediate = {
		change_variable = {
			which = stele_progress
			value = 1
		}
		if = {
			limit = {
				trigger_if = {
					limit = { has_character_flag = stele_cost_0 }
					check_variable = {
						which = stele_progress
						value = 5
					}
				}
				trigger_else_if = {
					limit = { has_character_flag = stele_cost_1 }
					check_variable = {
						which = stele_progress
						value = 7
					}
				}
				trigger_else = {
					has_character_flag = stele_cost_2
					check_variable = {
						which = stele_progress
						value = 10
					}
				}
			}
			character_event = { id = thelema.1004 days = 1 random = 363 }
		}
		else = {
			random_list = {
				10 = {
					trigger = {
						NOT = { has_character_flag = had_thelema_1010 }
					}
					character_event = { id = thelema.1010 days = 1 random = 250 }
				}
				10 = {
					trigger = {
						NOT = { has_character_flag = had_thelema_1011 }
					}
					character_event = { id = thelema.1011 days = 1 random = 250 }
				}
				10 = {
					trigger = {
						NOT = { has_character_flag = had_thelema_1012 }
					}
					character_event = { id = thelema.1012 days = 1 random = 250 }
				}
				70 = {
				}
			}
			character_event = { id = thelema.1002 days = 365 }
		}
	}
}
character_event = {
	id = thelema.1003
	is_triggered_only = yes
	picture = GFX_evt_runestone_raising_oldgods
	border = GFX_event_normal_frame_religion
	desc = EVTDESCTHELEMA1003
    option = {
        name = EVTOPTTHELEMA1003A
    }
    after = { #Clear and set all relevant flags...
		clr_character_flag = stele_cost_0
		clr_character_flag = stele_cost_1
		clr_character_flag = stele_cost_2
		clr_character_flag = had_thelema_1010
		clr_character_flag = had_thelema_1011
		clr_character_flag = had_thelema_1012
		
		remove_character_modifier = erecting_stele
		clear_persistent_event_target = stele_target
		clear_delayed_event = { id = thelema.1002 }
		hidden_tooltip = {
			set_variable = {
				which = stele_progress
				value = 0
			}
			set_variable = {
				which = stele_extra_quality
				value = 0
			}
		}
    }
}
character_event = {
	id = thelema.1004
	is_triggered_only = yes
	trigger = {
		allowed_to_use_stele_trigger = yes
	}
	fail_trigger_effect = {
		character_event = { id = thelema.1003 }
	}
	picture = GFX_evt_runestone_raising_oldgods
	border = GFX_event_normal_frame_religion
	desc = EVTDESCTHELEMA1004
	immediate = {
		random_list = {
			10 = { # Low quality
				trigger = {
					NOT = { has_character_flag = stele_cost_2 }
				}
				modifier = {
					factor = 1.5
					check_variable = {
						which = stele_extra_quality
						value <= -1
					}
				}
				modifier = {
					factor = 0.75
					check_variable = {
						which = stele_extra_quality
						value >= 1
					}
				}
				modifier = {
					factor = 0.75
					check_variable = {
						which = stele_extra_quality
						value >= 2
					}
				}
				add_artifact = stele_low_quality
			}
			10 = { # Medium quality
				set_character_flag = stele_medium_quality
			}
			5 = { # High quality
				trigger = {
					NOT = { has_character_flag = stele_cost_1 }
				}
				modifier = {
					factor = 0.66
					check_variable = {
						which = stele_extra_quality
						value <= -1
					}
				}
				modifier = {
					factor = 1.3
					check_variable = {
						which = stele_extra_quality
						value >= 1
					}
				}
				modifier = {
					factor = 1.3
					check_variable = {
						which = stele_extra_quality
						value >= 2
					}
				}
				set_character_flag = stele_high_quality
			}
		}
		if = {
			limit = {
				OR = {
					has_character_flag = stele_medium_quality
					has_character_flag = stele_high_quality
				}
			}
			random_list = {
				10 = {
					trigger = {
						persistent_event_target:stele_target = {
							NOT = { trait = shy }
						}
					}
					modifier = {
						factor = 4
						persistent_event_target:stele_target = {
							trait = charitable
						}
					}
					modifier = {
						factor = 2
						persistent_event_target:stele_target = {
							has_education_diplomacy_trigger = yes
						}
					}
					modifier = {
						factor = 3
						persistent_event_target:stele_target = {
							has_lifestyle_diplomacy_trigger = yes
						}
					}
					if = {
						limit = {
							has_character_flag = stele_medium_quality
						}
						add_artifact = stele_tongues_1
					}
					else = {
						add_artifact = stele_tongues_2
					}
				}
				10 = {
					trigger = {
						persistent_event_target:stele_target = {
							NOT = { trait = humble }
						}
					}
					modifier = {
						factor = 4
						persistent_event_target:stele_target = {
							trait = proud
						}
					}
					modifier = {
						factor = 2
						persistent_event_target:stele_target = {
							has_education_diplomacy_trigger = yes
						}
					}
					modifier = {
						factor = 3
						persistent_event_target:stele_target = {
							has_lifestyle_diplomacy_trigger = yes
						}
					}
					if = {
						limit = {
							has_character_flag = stele_medium_quality
						}
						add_artifact = stele_authority_1
					}
					else = {
						add_artifact = stele_authority_2
					}
				}
				10 = {
					trigger = {
						persistent_event_target:stele_target = {
							NOT = { trait = patient }
						}
					}
					modifier = {
						factor = 4
						persistent_event_target:stele_target = {
							trait = wroth
						}
					}
					modifier = {
						factor = 2
						persistent_event_target:stele_target = {
							has_education_martial_trigger = yes
						}
					}
					modifier = {
						factor = 3
						persistent_event_target:stele_target = {
							has_lifestyle_martial_trigger = yes
						}
					}
					if = {
						limit = {
							has_character_flag = stele_medium_quality
						}
						add_artifact = stele_wrath_1
					}
					else = {
						add_artifact = stele_wrath_2
					}
				}
				10 = {
					trigger = {
						persistent_event_target:stele_target = {
							NOT = { trait = wroth }
						}
					}
					modifier = {
						factor = 4
						persistent_event_target:stele_target = {
							trait = patient
						}
					}
					modifier = {
						factor = 2
						persistent_event_target:stele_target = {
							has_education_martial_trigger = yes
						}
					}
					modifier = {
						factor = 3
						persistent_event_target:stele_target = {
							has_lifestyle_martial_trigger = yes
						}
					}
					if = {
						limit = {
							has_character_flag = stele_medium_quality
						}
						add_artifact = stele_defense_1
					}
					else = {
						add_artifact = stele_defense_2
					}
				}
				10 = {
					trigger = {
						persistent_event_target:stele_target = {
							NOT = { trait = arbitrary }
						}
					}
					modifier = {
						factor = 4
						persistent_event_target:stele_target = {
							trait = just
						}
					}
					modifier = {
						factor = 2
						persistent_event_target:stele_target = {
							has_education_stewardship_trigger = yes
						}
					}
					modifier = {
						factor = 3
						persistent_event_target:stele_target = {
							has_lifestyle_stewardship_trigger = yes
						}
					}
					if = {
						limit = {
							has_character_flag = stele_medium_quality
						}
						add_artifact = stele_righteousness_1
					}
					else = {
						add_artifact = stele_righteousness_2
					}
				}
				10 = {
					trigger = {
						persistent_event_target:stele_target = {
							NOT = { trait = charitable }
						}
					}
					modifier = {
						factor = 4
						persistent_event_target:stele_target = {
							trait = greedy
						}
					}
					modifier = {
						factor = 2
						persistent_event_target:stele_target = {
							has_education_stewardship_trigger = yes
						}
					}
					modifier = {
						factor = 3
						persistent_event_target:stele_target = {
							has_lifestyle_stewardship_trigger = yes
						}
					}
					if = {
						limit = {
							has_character_flag = stele_medium_quality
						}
						add_artifact = stele_greed_1
					}
					else = {
						add_artifact = stele_greed_2
					}
				}
				10 = {
					trigger = {
						persistent_event_target:stele_target = {
							NOT = { trait = honest }
						}
					}
					modifier = {
						factor = 4
						persistent_event_target:stele_target = {
							trait = deceitful
						}
					}
					modifier = {
						factor = 2
						persistent_event_target:stele_target = {
							has_education_intrigue_trigger = yes
						}
					}
					modifier = {
						factor = 3
						persistent_event_target:stele_target = {
							has_lifestyle_intrigue_trigger = yes
						}
					}
					if = {
						limit = {
							has_character_flag = stele_medium_quality
						}
						add_artifact = stele_shadows_1
					}
					else = {
						add_artifact = stele_shadows_2
					}
				}
				10 = {
					trigger = {
						persistent_event_target:stele_target = {
							NOT = { trait = chaste }
						}
					}
					modifier = {
						factor = 4
						persistent_event_target:stele_target = {
							trait = lustful
						}
					}
					modifier = {
						factor = 2
						persistent_event_target:stele_target = {
							has_education_intrigue_trigger = yes
						}
					}
					modifier = {
						factor = 3
						persistent_event_target:stele_target = {
							has_lifestyle_intrigue_trigger = yes
						}
					}
					if = {
						limit = {
							has_character_flag = stele_medium_quality
						}
						add_artifact = stele_love_1
					}
					else = {
						add_artifact = stele_love_2
					}
				}
				10 = {
					trigger = {
						persistent_event_target:stele_target = {
							is_dumb_trigger = no
						}
					}
					modifier = {
						factor = 4
						persistent_event_target:stele_target = {
							is_smart_trigger = yes
						}
					}
					modifier = {
						factor = 2
						persistent_event_target:stele_target = {
							has_education_learning_trigger = yes
						}
					}
					modifier = {
						factor = 3
						persistent_event_target:stele_target = {
							has_lifestyle_learning_trigger = yes
						}
					}
					if = {
						limit = {
							has_character_flag = stele_medium_quality
						}
						add_artifact = stele_knowledge_1
					}
					else = {
						add_artifact = stele_knowledge_2
					}
				}
				10 = {
					trigger = {
						persistent_event_target:stele_target = {
							NOT = { trait = cynical }
						}
					}
					modifier = {
						factor = 4
						persistent_event_target:stele_target = {
							trait = zealous
						}
					}
					modifier = {
						factor = 2
						persistent_event_target:stele_target = {
							has_education_stewardship_trigger = yes
						}
					}
					modifier = {
						factor = 3
						persistent_event_target:stele_target = {
							has_lifestyle_stewardship_trigger = yes
						}
					}
					if = {
						limit = {
							has_character_flag = stele_medium_quality
						}
						add_artifact = stele_zeal_1
					}
					else = {
						add_artifact = stele_zeal_2
					}
				}
				fallback = {
					if = {
						limit = {
							has_character_flag = stele_medium_quality
						}
						add_artifact = stele_medium_quality
					}
					else = {
						add_artifact = stele_high_quality
					}
				}
			}
		}
		new_artifact = {
			save_event_target_as = new_book #for effects and localization purposes!
			set_description = stele_description
		}
	}
    option = {
        name = EVTOPTTHELEMA1004A

        custom_tooltip = {
        	text = new_book_added_tt
        }

    	if = { #Add some prestige...
    		limit = {
    			event_target:new_book = {
    				quality = 1
    				NOT = { quality = 2 }
    			}
    		}
    		prestige = 20
			piety = 20
    	}
    	if = {
    		limit = {
    			event_target:new_book = {
    				quality = 2
    				NOT = { quality = 3 }
    			}
    		}
    		prestige = 50
			piety = 50
    	}
    	if = {
    		limit = {
    			event_target:new_book = {
    				OR = {
    					quality = 3
    					quality = 4
    				}
    			}
    		}
    		prestige = 100
			piety = 100
    	}

    	if = { #add opinion bonus with the correct targets...
    		limit = {
				persistent_event_target:stele_target = {
					is_alive = yes
					NOT = { character = ROOT }
				}
			}

    		if = {
    			limit = {
    				persistent_event_target:stele_target = {
    					NOT = { is_rival = ROOT }
    				}
				}
				reverse_opinion = {
					who = persistent_event_target:stele_target
					modifier = opinion_flattered
					years = 20
				}
    		}
    		else = {
    			reverse_opinion = {
					who = persistent_event_target:stele_target
					modifier = opinion_strangely_flattered
					years = 20
				}
    		}

		}
    }
    after = { #Clear and set all relevant flags...
		clr_character_flag = stele_cost_0
		clr_character_flag = stele_cost_1
		clr_character_flag = stele_cost_2
		clr_character_flag = had_thelema_1010
		clr_character_flag = had_thelema_1011
		clr_character_flag = had_thelema_1012
		
		add_character_modifier = { name = erected_stele days = 7300 }
		remove_character_modifier = erecting_stele
		clear_persistent_event_target = stele_target
		hidden_tooltip = {
			set_variable = {
				which = stele_progress
				value = 0
			}
			set_variable = {
				which = stele_extra_quality
				value = 0
			}
		}
    }
}

character_event = {
	id = thelema.1010
	is_triggered_only = yes
	trigger = {
		allowed_to_use_stele_trigger = yes
	}
	fail_trigger_effect = {
		character_event = { id = thelema.1003 }
	}
	picture = GFX_evt_runestone_raising_oldgods
	border = GFX_event_normal_frame_religion
	desc = EVTDESCTHELEMA1010
	immediate = {
		set_character_flag = had_thelema_1010
	}
	option = {
		name = EVTOPTTHELEMA1010A
		custom_tooltip = {
			text = EVTOPTTHELEMA1010A_tooltip
			subtract_variable = {
				which = stele_progress
				value = 4
			}
			change_variable = {
				which = stele_extra_quality
				value = 1
			}
		}
	}
	option = {
		name = EVTOPTTHELEMA1010B
		custom_tooltip = {
			text = EVTOPTTHELEMA1010B_tooltip
		}
	}
	option = {
		name = EVTOPTTHELEMA1010C
		custom_tooltip = {
			text = EVTOPTTHELEMA1010C_tooltip
			change_variable = {
				which = stele_progress
				value = 3
			}
			subtract_variable = {
				which = stele_extra_quality
				value = 1
			}
		}
	}
}

character_event = {
	id = thelema.1011
	is_triggered_only = yes
	trigger = {
		allowed_to_use_stele_trigger = yes
	}
	fail_trigger_effect = {
		character_event = { id = thelema.1003 }
	}
	picture = GFX_evt_runestone_raising_oldgods
	border = GFX_event_normal_frame_religion
	desc = EVTDESCTHELEMA1011
	immediate = {
		set_character_flag = had_thelema_1011
	}
	option = {
		name = EVTOPTTHELEMA1011A
		piety = 50
		custom_tooltip = {
			text = EVTOPTTHELEMA1011A_tooltip
			subtract_variable = {
				which = stele_progress
				value = 2
			}
		}
	}
	option = {
		name = EVTOPTTHELEMA1011B
		piety = 100
		custom_tooltip = {
			text = EVTOPTTHELEMA1011B_tooltip
			subtract_variable = {
				which = stele_progress
				value = 6
			}
			change_variable = {
				which = stele_extra_quality
				value = 1
			}
		}
	}
	option = {
		name = EVTOPTTHELEMA1011C
		piety = -50
		custom_tooltip = {
			text = EVTOPTTHELEMA1010B_tooltip
		}
	}
}

character_event = {
	id = thelema.1012
	is_triggered_only = yes
	trigger = {
		allowed_to_use_stele_trigger = yes
	}
	fail_trigger_effect = {
		character_event = { id = thelema.1003 }
	}
	picture = GFX_evt_runestone_raising_oldgods
	border = GFX_event_normal_frame_religion
	desc = EVTDESCTHELEMA1012
	immediate = {
		set_character_flag = had_thelema_1012
	}
	option = {
		name = EVTOPTTHELEMA1012A
		if = {
			limit = {
				prefers_men_trigger = yes
			}
			create_character = {
				random_traits = yes
				dynasty = actually_culture
				female = no
				age = 17
			}
		}
		else = {
			create_character = {
				random_traits = yes
				dynasty = actually_culture
				female = no
				age = 17
			}
		}
		custom_tooltip = {
			text = EVTOPTTHELEMA1011A_tooltip
			new_character = {
				remove_disease_trait_effect = yes
				clear_disease_level_effect = yes
				remove_disease_flags_effect = yes
				
				add_trait = fair
				add_lover = ROOT
			}
			subtract_variable = {
				which = stele_progress
				value = 2
			}
		}
	}
	option = {
		name = EVTOPTTHELEMA1012B
		if = {
			limit = {
				prefers_men_trigger = yes
			}
			create_character = {
				random_traits = yes
				dynasty = actually_culture
				female = no
				age = 17
			}
		}
		else = {
			create_character = {
				random_traits = yes
				dynasty = actually_culture
				female = no
				age = 17
			}
		}
		scaled_wealth = {
			value = -0.1
			min = -5
			max = -101
		}
		custom_tooltip = {
			text = EVTOPTTHELEMA1010B_tooltip
			new_character = {
				remove_disease_trait_effect = yes
				clear_disease_level_effect = yes
				remove_disease_flags_effect = yes
				
				add_trait = fair
				add_lover = ROOT
			}
		}
	}
	option = {
		name = EVTOPTTHELEMA1012C
		prestige = -25
		custom_tooltip = {
			text = EVTOPTTHELEMA1010B_tooltip
		}
	}
}

character_event = {
	id = thelema.1013
	is_triggered_only = yes
	picture = GFX_evt_the_cover
	border = GFX_event_normal_frame_religion
	desc = EVTDESCTHELEMA1013
	immediate = {
		random_list = {
			5 = {
				narrative_event = {
					id = thelema.1014	days = 3 random = 1
				}
			}
			5 = {
				narrative_event = {
					id = thelema.1015	days = 3 random = 1
				}
			}
			5 = {
				narrative_event = {
					id = thelema.1016	days = 3 random = 1
				}
			}
			5 = {
				narrative_event = {
					id = thelema.1017	days = 3 random = 1
				}
			}
			5 = {
				narrative_event = {
					id = thelema.1018	days = 3 random = 1
				}
			}
			5 = {
				narrative_event = {
					id = thelema.1019	days = 3 random = 1
				}
			}
			5 = {
				narrative_event = {
					id = thelema.1020	days = 3 random = 1
				}
			}
			5 = {
				narrative_event = {
					id = thelema.1021	days = 3 random = 1
				}
			}
			5 = {
				narrative_event = {
					id = thelema.1022	days = 3 random = 1
				}
			}
			5 = {
				narrative_event = {
					id = thelema.1023	days = 3 random = 1
				}
			}
			5 = {
				narrative_event = {
					id = thelema.1024	days = 3 random = 1
				}
			}
			5 = {
				narrative_event = {
					id = thelema.1025	days = 3 random = 1
				}
			}
			4 = {
				narrative_event = {
					id = thelema.1026	days = 3 random = 1
				}
			}
			4 = {
				narrative_event = {
					id = thelema.1027	days = 3 random = 1
				}
			}
			4 = {
				narrative_event = {
					id = thelema.1028	days = 3 random = 1
				}
			}
			4 = {
				narrative_event = {
					id = thelema.1029	days = 3 random = 1
				}
			}
			4 = {
				narrative_event = {
					id = thelema.1030	days = 3 random = 1
				}
			}
			4 = {
				narrative_event = {
					id = thelema.1031	days = 3 random = 1
				}
			}
			4 = {
				narrative_event = {
					id = thelema.1032	days = 3 random = 1
				}
			}
			4 = {
				narrative_event = {
					id = thelema.1033	days = 3 random = 1
				}
			}
			4 = {
				narrative_event = {
					id = thelema.1034	days = 3 random = 1
				}
			}
			4 = {
				narrative_event = {
					id = thelema.1035	days = 3 random = 1
				}
			}
		}
	}
	option = {
		name = EVTOPTTHELEMA1013A
	}
}
character_event = {
	id = thelema.1014#the fool
	is_triggered_only = yes
	picture = GFX_evt_the_fool
	border = GFX_event_normal_frame_religion
	desc = EVTDESCTHELEMA1014
	immediate = {
		random_list = {
			6 = {
				add_character_modifier = { name = the_magician_modif duration = 1825 }#1
			}
			6 = {
				add_character_modifier = { name = the_high_priestess_modif duration = 1825 }#2
			}
			6 = {
				add_character_modifier = { name = the_empress_modif duration = 1825 }#3
			}
			5 = {
				add_character_modifier = { name = the_emperor_modif duration = 1825 }#4
			}
			5 = {
				add_character_modifier = { name = the_hierophant_modif duration = 1825 }#5
			}
			5 = {
				add_character_modifier = { name = the_lovers_modif duration = 1825 }#6
			}
			5 = {
				add_character_modifier = { name = the_chariot_modif duration = 1825 }#7
			}
			5 = {
				add_character_modifier = { name = the_strength_modif duration = 1825 }#8
			}
			5 = {
				add_character_modifier = { name = the_hermit_modif duration = 1825 }#9
			}
			5 = {
				add_character_modifier = { name = the_wheel_of_fortune_modif duration = 1825 }#10
			}
			5 = {
				add_character_modifier = { name = the_justice_modif duration = 1825 }#10
			}
			4 = {
				mult_modifier = {
					factor = 0.5
					trait = mystic
				}
				mult_modifier = {
					factor = 0.75
					trait = scholarly_theologian
				}
				mult_modifier = {
					factor = 0.5
					trait = mastermind_theologian
				}
				add_character_modifier = { name = the_hanged_man_modif duration = 1825 }#11
			}
			4 = {
				mult_modifier = {
					factor = 0.5
					trait = mystic
				}
				mult_modifier = {
					factor = 0.75
					trait = scholarly_theologian
				}
				mult_modifier = {
					factor = 0.5
					trait = mastermind_theologian
				}
				add_character_modifier = { name = the_death_modif duration = 1825 }#12
			}
			5 = {
				add_character_modifier = { name = the_temperance_modif duration = 1825 }#13
			}
			5 = {
				add_character_modifier = { name = the_devil_modif duration = 1825 }#14
			}
			4 = {
				mult_modifier = {
					factor = 0.5
					trait = mystic
				}
				mult_modifier = {
					factor = 0.75
					trait = scholarly_theologian
				}
				mult_modifier = {
					factor = 0.5
					trait = mastermind_theologian
				}
				add_character_modifier = { name = the_tower_modif duration = 1825 }#15
			}
			4 = {
				add_character_modifier = { name = the_star_modif duration = 1825 }#16
			}
			4 = {
				add_character_modifier = { name = the_moon_modif duration = 1825 }#17
			}
			4 = {
				add_character_modifier = { name = the_sun_modif duration = 1825 }#18
			}
			4 = {
				add_character_modifier = { name = the_judgement_modif duration = 1825 }#19
			}
			4 = {
				add_character_modifier = { name = the_world_modif duration = 1825 }#20
			}
		}
	}
	option = {
		name = EVTOPTTHELEMA1014A
	}
}
character_event = {
	id = thelema.1015#the magician
	is_triggered_only = yes
	picture = GFX_evt_the_magician
	border = GFX_event_normal_frame_religion
	desc = EVTDESCTHELEMA1015
	immediate = {
		add_character_modifier = { name = the_magician_modif duration = 1825 }
	}
	option = {
		name = EVTOPTTHELEMA1015A
	}
}
character_event = {
	id = thelema.1016#the high priestess
	is_triggered_only = yes
	picture = GFX_evt_the_high_priestess
	border = GFX_event_normal_frame_religion
	desc = EVTDESCTHELEMA1016
	immediate = {
		add_character_modifier = { name = the_high_priestess_modif duration = 1825 }
	}
	option = {
		name = EVTOPTTHELEMA1016A
	}
}
character_event = {
	id = thelema.1017#the empress
	is_triggered_only = yes
	picture = GFX_evt_the_empress
	border = GFX_event_normal_frame_religion
	desc = EVTDESCTHELEMA1017
	immediate = {
		add_character_modifier = { name = the_empress_modif duration = 1825 }
	}
	option = {
		name = EVTOPTTHELEMA1017A
	}
}
character_event = {
	id = thelema.1018#the emperor
	is_triggered_only = yes
	picture = GFX_evt_the_emperor
	border = GFX_event_normal_frame_religion
	desc = EVTDESCTHELEMA1018
	immediate = {
		add_character_modifier = { name = the_emperor_modif duration = 1825 }
	}
	option = {
		name = EVTOPTTHELEMA1018A
	}
}
character_event = {
	id = thelema.1019#the hierophant
	is_triggered_only = yes
	picture = GFX_evt_the_hierophant
	border = GFX_event_normal_frame_religion
	desc = EVTDESCTHELEMA1019
	immediate = {
		add_character_modifier = { name = the_hierophant_modif duration = 1825 }
	}
	option = {
		name = EVTOPTTHELEMA1019A
	}
}
character_event = {
	id = thelema.1020#the lovers
	is_triggered_only = yes
	picture = GFX_evt_the_lovers
	border = GFX_event_normal_frame_religion
	desc = EVTDESCTHELEMA1020
	immediate = {
		add_character_modifier = { name = the_lovers_modif duration = 1825 }
	}
	option = {
		name = EVTOPTTHELEMA1020A
	}
}
character_event = {
	id = thelema.1021#the chariot
	is_triggered_only = yes
	picture = GFX_evt_the_chariot
	border = GFX_event_normal_frame_religion
	desc = EVTDESCTHELEMA1021
	immediate = {
		add_character_modifier = { name = the_chariot_modif duration = 1825 }
	}
	option = {
		name = EVTOPTTHELEMA1021A
	}
}
character_event = {
	id = thelema.1022#the strength
	is_triggered_only = yes
	picture = GFX_evt_strength
	border = GFX_event_normal_frame_religion
	desc = EVTDESCTHELEMA1022
	immediate = {
		add_character_modifier = { name = the_strength_modif duration = 1825 }
	}
	option = {
		name = EVTOPTTHELEMA1022A
	}
}
character_event = {
	id = thelema.1023#the hermit
	is_triggered_only = yes
	picture = GFX_evt_the_hermit
	border = GFX_event_normal_frame_religion
	desc = EVTDESCTHELEMA1023
	immediate = {
		add_character_modifier = { name = the_hermit_modif duration = 1825 }
	}
	option = {
		name = EVTOPTTHELEMA1023A
	}
}
character_event = {
	id = thelema.1024#the wheel of fortune
	is_triggered_only = yes
	picture = GFX_evt_wheel_of_fortune
	border = GFX_event_normal_frame_religion
	desc = EVTDESCTHELEMA1024
	immediate = {
		add_character_modifier = { name = the_wheel_of_fortune_modif duration = 1825 }
	}
	option = {
		name = EVTOPTTHELEMA1024A
	}
}
character_event = {
	id = thelema.1025#justice
	is_triggered_only = yes
	picture = GFX_evt_justice
	border = GFX_event_normal_frame_religion
	desc = EVTDESCTHELEMA1025
	immediate = {
		add_character_modifier = { name = the_justice_modif duration = 1825 }
	}
	option = {
		name = EVTOPTTHELEMA1025A
	}
}
character_event = {
	id = thelema.1026#the hanged man
	is_triggered_only = yes
	picture = GFX_evt_the_hanged_man
	border = GFX_event_normal_frame_religion
	desc = EVTDESCTHELEMA1026
	immediate = {
		add_character_modifier = { name = the_hanged_man_modif duration = 1825 }
	}
	option = {
		name = EVTOPTTHELEMA1026A
	}
}
character_event = {
	id = thelema.1027#death
	is_triggered_only = yes
	picture = GFX_evt_the_death
	border = GFX_event_normal_frame_religion
	desc = EVTDESCTHELEMA1027
	immediate = {
		add_character_modifier = { name = the_death_modif duration = 1825 }
	}
	option = {
		name = EVTOPTTHELEMA1027A
	}
}
character_event = {
	id = thelema.1028#temperance
	is_triggered_only = yes
	picture = GFX_evt_temperance
	border = GFX_event_normal_frame_religion
	desc = EVTDESCTHELEMA1028
	immediate = {
		add_character_modifier = { name = the_temperance_modif duration = 1825 }
	}
	option = {
		name = EVTOPTTHELEMA1028A
	}
}
character_event = {
	id = thelema.1029#the devil
	is_triggered_only = yes
	picture = GFX_evt_the_devil
	border = GFX_event_normal_frame_religion
	desc = EVTDESCTHELEMA1029
	immediate = {
		add_character_modifier = { name = the_devil_modif duration = 1825 }
	}
	option = {
		name = EVTOPTTHELEMA1029A
	}
}
character_event = {
	id = thelema.1030#the tower
	is_triggered_only = yes
	picture = GFX_evt_the_tower
	border = GFX_event_normal_frame_religion
	desc = EVTDESCTHELEMA1030
	immediate = {
		add_character_modifier = { name = the_tower_modif duration = 1825 }
	}
	option = {
		name = EVTOPTTHELEMA1030A
	}
}
character_event = {
	id = thelema.1031#the star
	is_triggered_only = yes
	picture = GFX_evt_the_star
	border = GFX_event_normal_frame_religion
	desc = EVTDESCTHELEMA1031
	immediate = {
		add_character_modifier = { name = the_star_modif duration = 1825 }
	}
	option = {
		name = EVTOPTTHELEMA1031A
	}
}
character_event = {
	id = thelema.1032#the moon
	is_triggered_only = yes
	picture = GFX_evt_the_moon
	border = GFX_event_normal_frame_religion
	desc = EVTDESCTHELEMA1032
	immediate = {
		add_character_modifier = { name = the_moon_modif duration = 1825 }
	}
	option = {
		name = EVTOPTTHELEMA1032A
	}
}
character_event = {
	id = thelema.1033#the sun
	is_triggered_only = yes
	picture = GFX_evt_the_sun
	border = GFX_event_normal_frame_religion
	desc = EVTDESCTHELEMA1033
	immediate = {
		add_character_modifier = { name = the_sun_modif duration = 1825 }
	}
	option = {
		name = EVTOPTTHELEMA1033A
	}
}
character_event = {
	id = thelema.1034#judgement
	is_triggered_only = yes
	picture = GFX_evt_judgement
	border = GFX_event_normal_frame_religion
	desc = EVTDESCTHELEMA1034
	immediate = {
		add_character_modifier = { name = the_judgement_modif duration = 1825 }
	}
	option = {
		name = EVTOPTTHELEMA1034A
	}
}
character_event = {
	id = thelema.1035#the world
	is_triggered_only = yes
	picture = GFX_evt_the_world
	border = GFX_event_normal_frame_religion
	desc = EVTDESCTHELEMA1035
	immediate = {
		add_character_modifier = { name = the_world_modif duration = 1825 }
	}
	option = {
		name = EVTOPTTHELEMA1035A
	}
}

# Thelema becoming an unworthy priest
character_event = {
	id = thelema.1036
	desc = EVTDESCTHELEMA1036
	picture = GFX_evt_scandal
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes

	min_age = 16
	only_capable = yes
	prisoner = no	
	religion_group = esoteric
	
	trigger = {
		NOR = {
			intrigue = 3
			diplomacy = 3
			trait = bad_priest_thelemic
		}
		OR = {
			religion = thelemic
			religion = theosophy
			religion = thelemic_reformed
			religion = summer_queen
			religion = orange_king
		}
		OR = {
			is_priest = yes
			has_landed_title = d_thelema
		}
		has_dlc = "Sons of Abraham"
		OR = {
			trait = cynical
			trait = temperate
			trait = slothful
			trait = envious
			trait = wroth
			trait = chaste
			trait = celibate
		}
	}

	option = {
		name = EVTOPTTHELEMA1036
		add_trait = bad_priest_thelemic
		if = {
			limit = {
				is_ruler = yes
				has_nickname = no
				NOT = { trait = possessed }
				NOT = { trait = lunatic }
			}
			give_nickname = nick_the_unready
		}
		if = {
			limit = {
				is_ruler = yes
				has_nickname = no
				trait = chaste
			}
			give_nickname = nick_the_lame
		}
		if = {
			limit = {
				is_ruler = yes
				has_nickname = no
				trait = celibate
			}
			give_nickname = nick_the_lame
		}
	}
}

# Unworthy Head Priest player notification
character_event = {
	id = thelema.1037
	desc = EVTDESCTHELEMA1037
	picture = GFX_evt_viking_throneroom_oldgods
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes

	option = {
		name = EVTOPTTHELEMA1037
	}
}

character_event = {
	id = thelema.1038
	desc = EVTDESCTHELEMA1037
	picture = GFX_evt_viking_throneroom_oldgods
	border = GFX_event_normal_frame_religion
	hide_window = yes
	religion_group = esoteric
	
	trigger = {
		OR = {
			religion = thelemic
			religion = theosophy
			religion = thelemic_reformed
			religion = orange_king
			religion = summer_queen
		}
		num_of_lovers = 1
		NOR = {
			has_character_modifier = thelema_magika_modifier_1
			has_character_modifier = thelema_magika_modifier_2
			has_character_modifier = thelema_magika_modifier_3
		}
	}
	mean_time_to_happen = {
		days = 1
	}
	immediate = {
		if = {
			limit = {
				num_of_lovers == 1
			}
			add_character_modifier = { name = thelema_magika_modifier_1 duration = -1 }
		}
		else_if = {
			limit = {
				num_of_lovers == 2
			}
			add_character_modifier = { name = thelema_magika_modifier_2 duration = -1 }
		}
		else = {
			add_character_modifier = { name = thelema_magika_modifier_3 duration = -1 }
		}
	}
}
character_event = {
	id = thelema.1039
	desc = EVTDESCTHELEMA1037
	picture = GFX_evt_viking_throneroom_oldgods
	border = GFX_event_normal_frame_religion
	hide_window = yes
	religion_group = esoteric
	
	trigger = {
		OR = {
			AND = {
				num_of_lovers == 1
				has_character_modifier = thelema_magika_modifier_2
			}
			AND = {
				num_of_lovers == 2
				has_character_modifier = thelema_magika_modifier_1
			}
			AND = {
				num_of_lovers == 2
				has_character_modifier = thelema_magika_modifier_3
			}
			AND = {
				num_of_lovers == 3
				has_character_modifier = thelema_magika_modifier_2
			}
			AND = {
				num_of_lovers == 1
				has_character_modifier = thelema_magika_modifier_3
			}
			AND = {
				num_of_lovers == 3
				has_character_modifier = thelema_magika_modifier_1
			}
			AND = {
				num_of_lovers == 0
				OR = {
					has_character_modifier = thelema_magika_modifier_1
					has_character_modifier = thelema_magika_modifier_2
					has_character_modifier = thelema_magika_modifier_3
				}
			}
		}
	}
	mean_time_to_happen = {
		days = 90
	}
	immediate = {
		if = {
			limit = {
				num_of_lovers == 1
				has_character_modifier = thelema_magika_modifier_2
			}
			remove_character_modifier = thelema_magika_modifier_2
			add_character_modifier = { name = thelema_magika_modifier_1 duration = -1 }
		}
		else_if = {
			limit = {
				num_of_lovers == 2
				has_character_modifier = thelema_magika_modifier_1
			}
			remove_character_modifier = thelema_magika_modifier_1
			add_character_modifier = { name = thelema_magika_modifier_2 duration = -1 }
		}
		else_if = {
			limit = {
				num_of_lovers == 2
				has_character_modifier = thelema_magika_modifier_3
			}
			remove_character_modifier = thelema_magika_modifier_3
			add_character_modifier = { name = thelema_magika_modifier_2 duration = -1 }
		}
		else_if = {
			limit = {
				num_of_lovers == 3
				has_character_modifier = thelema_magika_modifier_2
			}
			remove_character_modifier = thelema_magika_modifier_2
			add_character_modifier = { name = thelema_magika_modifier_3 duration = -1 }
		}
		else_if = {
			limit = {
				num_of_lovers == 1
				has_character_modifier = thelema_magika_modifier_3
			}
			remove_character_modifier = thelema_magika_modifier_3
			add_character_modifier = { name = thelema_magika_modifier_1 duration = -1 }
		}
		else_if = {
			limit = {
				num_of_lovers == 3
				has_character_modifier = thelema_magika_modifier_1
			}
			remove_character_modifier = thelema_magika_modifier_1
			add_character_modifier = { name = thelema_magika_modifier_3 duration = -1 }
		}
		else_if = {
			limit = {
				num_of_lovers = 3
				has_character_modifier = thelema_magika_modifier_3
			}
		}
		else = {
			remove_character_modifier = thelema_magika_modifier_1
			remove_character_modifier = thelema_magika_modifier_2
			remove_character_modifier = thelema_magika_modifier_3
		}
	}
}