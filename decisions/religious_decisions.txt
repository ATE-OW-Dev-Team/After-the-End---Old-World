###########################################
#
# Religious Decisions for Sons of Abraham
#
###########################################
# Written by Henrik Fåhraeus
###########################################

decisions = {

		nobelian_dive_occult = {
			only_playable = yes
			is_high_prio = yes
			ai_check_interval = 24
			
			potential = {
				religion = nobelian
			}
			allow = {
				NOT = {
					has_character_flag = recently_searched
				}
			}
			effect = {
				set_character_flag = nobel_diving_occult
				character_event = { id = nobelian.1 }
			}
		}

		balkaner_secret_religion = {
		only_playable = yes
		
		is_high_prio = yes
		ai_check_interval = 12
	
		potential = {
			NOR = {
				has_global_flag = yugoslavism_triumphant
				has_global_flag = yugoslavism_survives
				secret_religion = catholic
				secret_religion = orthodox
				secret_religion = sunni
				primary_title = {
					title = e_yugoslavia
				}
			}
			is_playable = yes
			religion = jugoslavist
			OR = {
				culture = croatian
				culture = slovenian
				culture = bosnian
				culture = serbian
				culture = bulgarian
			}
		}
		
		allow = {
			NOR = {
				trait = content
				trait = slothful
				trait = cynical
			}
		}
		
		effect = {
			if = {
				limit = {
					OR = {
						culture = croatian
						culture = slovenian
					}
				}
			set_secret_religion = catholic
			}
			if = {
				limit = {
						culture = bosnian
				}
			set_secret_religion = sunni
			}
			if = {
				limit = {
					OR = {
						culture = serbian
						culture = bulgarian
					}
				}
			set_secret_religion = orthodox
			}
		join_society = secret_religious_cult
		if = { 
			limit = {
				NOT = { any_society_member = { is_society_grandmaster = yes } }
			}
			set_society_grandmaster = yes # Set character as Grand Master
			add_society_currency_massive_effect = yes # Give the Grand Master a start-up capital to induct members
		}
		}
		
		revoke_allowed = {
			always = no
		}
		
		ai_will_do = {
			factor = 0.05#This becomes more and more likely the lower Yugoslavist MA is, starts at 5% chance
			modifier = {#7.5%
				factor = 1.5
				NOT = {
					religion_authority = 0.7 #If the MA is below 70, every 10 points of MA lost increases the chance of the AI doing this
				}
			}
			modifier = {#11%
				factor = 1.5
				NOT = {
					religion_authority = 0.6 #If the MA is below 70, every 10 points of MA lost increases the chance of the AI doing this
				}
			}
			modifier = {#17%
				factor = 1.5
				NOT = {
					religion_authority = 0.5 #If the MA is below 70, every 10 points of MA lost increases the chance of the AI doing this
				}
			}
			modifier = {#25%
				factor = 1.5
				NOT = {
					religion_authority = 0.4 #If the MA is below 70, every 10 points of MA lost increases the chance of the AI doing this
				}
			}
			modifier = {#38%
				factor = 1.5
				NOT = {
					religion_authority = 0.3 #If the MA is below 70, every 10 points of MA lost increases the chance of the AI doing this
				}
			}
			modifier = {#56% at 1.5, more with 1.75
				factor = 1.75
				NOT = {
					religion_authority = 0.2 #If the MA is below 70, every 10 points of MA lost increases the chance of the AI doing this
				}
			}
			modifier = {#85% at 1,5m more with 1.75
				factor = 1.75
				NOT = {
					religion_authority = 0.1 #If the MA is below 70, every 10 points of MA lost increases the chance of the AI doing this
				}
			}
			modifier = {#The emperor abandoning Yugoslavist makes this far more likely
				factor = 4
				top_liege = {
					NOT = {
						religion = jugoslavist
					}
				}
			}			
		}
	}
	
		balkaner_abandon_jugo = {
		only_playable = yes
		
		is_high_prio = yes
		ai_check_interval = 36
	
		potential = {
			NOT = {
				primary_title = { title = e_yugoslavia }
			}
			controls_religion = no # The Propiciater shouldn't be able to, obviously

			NOR = {#can't do it if Jugo has won
				has_global_flag = yugoslavism_triumphant
				has_global_flag = yugoslavism_survives
			}			
			
			is_playable = yes
			religion = jugoslavist
			OR = {
				culture = croatian
				culture = slovenian
				culture = bosnian
				culture = serbian
				culture = bulgarian
			}
		}
		
		allow = {
			OR = {#outright defiance requires either the Car having apostasised, or not being his vassal
				top_liege = {
					NOT = {
						religion = jugoslavist
					}
				}
				independent = yes
			}
			NOR = {
				trait = content
				trait = slothful
				trait = cynical
			}
		}
		
		effect = {
		
			if = {#if you have a secret religion, out yourself
				limit = {
					has_secret_religion = yes
				}
				convert_to_secret_religion = yes
			}
		
			else_if = {
				limit = {
						has_secret_religion = no
						OR = {
						culture = croatian
						culture = slovenian
						}
				}
			religion = catholic
			}
			else_if = {
				limit = {
						has_secret_religion = no
						culture = bosnian
					}
					religion = sunni
				}
			else_if = {
				limit = {
					has_secret_religion = no
					OR = {
						culture = serbian
						culture = bulgarian
					}
				}
			religion = orthodox
			}
		}
		
		revoke_allowed = {
			always = no
		}
		
		ai_will_do = {
			factor = 0.05#This becomes more and more likely the lower Yugoslavist MA is, starts at 5% chance
			modifier = {#7.5%
				factor = 1.5
				NOT = {
					religion_authority = 0.7 #If the MA is below 70, every 10 points of MA lost increases the chance of the AI doing this
				}
			}
			modifier = {#11%
				factor = 1.5
				NOT = {
					religion_authority = 0.6 #If the MA is below 70, every 10 points of MA lost increases the chance of the AI doing this
				}
			}
			modifier = {#17%
				factor = 1.5
				NOT = {
					religion_authority = 0.5 #If the MA is below 70, every 10 points of MA lost increases the chance of the AI doing this
				}
			}
			modifier = {#25%
				factor = 1.5
				NOT = {
					religion_authority = 0.4 #If the MA is below 70, every 10 points of MA lost increases the chance of the AI doing this
				}
			}
			modifier = {#38%
				factor = 1.5
				NOT = {
					religion_authority = 0.3 #If the MA is below 70, every 10 points of MA lost increases the chance of the AI doing this
				}
			}
			modifier = {#56%
				factor = 1.75
				NOT = {
					religion_authority = 0.2 #If the MA is below 70, every 10 points of MA lost increases the chance of the AI doing this
				}
			}
			modifier = {#85%
				factor = 1.75
				NOT = {
					religion_authority = 0.1 #If the MA is below 70, every 10 points of MA lost increases the chance of the AI doing this
				}
			}
			modifier = {#The emperor abandoning Yugoslavist makes this far more likely
				factor = 4
				top_liege = {
					NOT = {
						religion = jugoslavist
					}
				}
			}			
		}
	}
	
	strengthen_jugoslavism = {
		only_playable = yes
		
		is_high_prio = yes
		ai_check_interval = 36
	
		potential = {
			is_playable = yes
			religion = jugoslavist
			independent = yes
			has_global_flag = yugoslavism_survives
			religion_authority = 0.5#at least 50 MA
			NOT = {
				has_global_flag = yugoslavism_triumphant
			}
			NOT = {
				has_alternate_start_parameter = { key = religion_names value = random }
			}
		}
		
		allow = {
			realm_size = 100
			prestige = 1000
			piety = 500
		}
		
		effect = {
			character_event = { id = yugoslav.8}#triumph of Yugoslavist
		}
		
		revoke_allowed = {
			always = no
		}
		
		ai_will_do = {
			factor = 1
		}
	}

	create_high_chairman = {
		only_playable = yes
		
		is_high_prio = yes
		ai_check_interval = 36
	
		potential = {
			is_playable = yes
			religion = stalinist
			NOT = { is_title_active = d_stalinist }
			NOT = {
				has_alternate_start_parameter = { key = religion_names value = random }
			}
		}
		
		allow = {
			piety = 1000
			num_of_holy_sites = 3
		}
		
		effect = {
			activate_title = { title = d_stalinist status = yes }
			d_stalinist = {
				grant_title = ROOT
			}	
		}
		
		revoke_allowed = {
			always = no
		}
		
		ai_will_do = {
			factor = 1
		}
	}

	create_zardom = {
		only_playable = yes
		
		is_high_prio = yes
		ai_check_interval = 36
	
		potential = {
			is_playable = yes
			religion = zarist
			NOT = { is_title_active = k_kremlin }
			NOT = {
				has_alternate_start_parameter = { key = religion_names value = random }
			}
		}
		
		allow = {
			piety = 1000
			primary_title = { title = e_great_russia }
			OR = {
				owns = 575 # Moscow
				any_realm_lord = {
					owns = 575
				}
			}
		}
		
		effect = {
			activate_title = { title = k_kremlin status = yes }
			k_kremlin = {
				grant_title = ROOT
			}	
			hidden_tooltip = {
			religion_authority = {
				modifier = papacy_instituted
				years = 20
			}

		}
		}
		
		revoke_allowed = {
			always = no
		}
		
		ai_will_do = {
			factor = 1
		}
	}
	
	steal_zardom = {
		only_playable = yes
		
		is_high_prio = yes
		ai_check_interval = 36
	
		potential = {
			is_playable = yes
			religion = zarist
			is_title_active = k_kremlin
			k_kremlin = {
				holder_scope = {
					NOT = { character = ROOT }
				}
			}		
			NOT = {
				has_alternate_start_parameter = { key = religion_names value = random }
			}
		}
		
		allow = {
			piety = 1000
			primary_title = { title = e_great_russia }
			owns = 575 # Moscow
		}
		
		effect = {
			k_kremlin = {
				grant_title = ROOT
			}
			add_piety = -1000
		}
		
		revoke_allowed = {
			always = no
		}
		
		ai_will_do = {
			factor = 1
		}
	}
	
	create_fraticelli_papacy = {
		only_playable = yes
		
		is_high_prio = yes
		ai_check_interval = 36
	
		potential = {
			is_playable = yes
			religion = fraticelli
			NOT = { is_title_active = d_fraticelli }
			has_dlc = "Sons of Abraham"
			NOT = {
				has_alternate_start_parameter = { key = religion_names value = random }
			}
		}
		
		allow = {
			piety = 1000
			OR = {
				owns = 333 # Rome
				any_realm_lord = {
					owns = 333
				}
			}
		}
		
		effect = {
			activate_title = { title = d_fraticelli status = yes }
			hidden_tooltip = {
				create_random_priest = {
					dynasty = none
					random_traits = yes
				}
				new_character = {
					d_fraticelli = {
						grant_title = PREV
					}
					wealth = 500
					opinion = {
						who = ROOT
						modifier = opinion_creator_of_rel_heal
					}
				}
				
				religion_authority = {
					modifier = papacy_instituted
					years = 20
				}
			}
			hidden_effect = {
				character_event = { id = 39703 }
			}
			piety = 1000
		}
		
		revoke_allowed = {
			always = no
		}
		
		ai_will_do = {
			factor = 1
		}
	}
	
	create_iconoclast_patriarchy = {
		only_playable = yes
		
		is_high_prio = yes
		ai_check_interval = 36
	
		potential = {
			is_playable = yes
			religion = iconoclast
			NOT = { is_title_active = d_iconoclast }
			has_dlc = "Sons of Abraham"
			NOT = {
				has_alternate_start_parameter = { key = religion_names value = random }
			}
		}
		
		allow = {
			piety = 1000
			OR = {
				owns = 496 # Constantinople
				any_realm_lord = {
					owns = 496
				}
			}
		}
		
		effect = {
			activate_title = { title = d_iconoclast status = yes }
			hidden_tooltip = {
				create_random_priest = {
					dynasty = none
					random_traits = yes
				}
				new_character = {
					d_iconoclast = {
						grant_title = PREV
					}
					wealth = 500
					opinion = {
						who = ROOT
						modifier = opinion_creator_of_rel_heal
					}
				}
				
				religion_authority = {
					modifier = patriarchy_instituted
					years = 20
				}
			}
			hidden_effect = {
				long_character_event = { id = 39704 }
			}
			piety = 1000
		}
		
		revoke_allowed = {
			always = no
		}
		
		ai_will_do = {
			factor = 1
		}
	}
	
	restore_pope_in_rome = {
		only_independent = yes
		is_high_prio = yes
		ai_check_interval = 36
	
		potential = {
			is_playable = yes
			independent = yes
			has_dlc = "Sons of Abraham"
			NOT = {
				has_alternate_start_parameter = { key = religion_names value = random }
			}
			OR = {
				religion = catholic
				AND = {
					religion = fraticelli
					is_title_active = d_fraticelli
				}
			}
			
			controls_religion = no
			
			c_roma = {
				holder_scope = {
					OR = {
						character = ROOT
						is_liege_or_above = ROOT
					}
					OR = {
						AND = {
							ROOT = { religion = catholic }
							k_papal_state = {
								holder_scope = {
									NOT = { character = PREVPREV }
									NOT = { is_vassal_or_below = PREVPREV }
								}
							}
						}
						AND = {
							ROOT = { religion = fraticelli }
							d_fraticelli = {
								holder_scope = {
									NOT = { character = PREVPREV }
									NOT = { is_vassal_or_below = PREVPREV }
								}
							}
						}
					}
				}
			}
		}
		
		effect = {		
			if = {
				limit = {
					religion = catholic
				}
				k_papal_state = {
					holder_scope = {
						c_roma = {
							grant_title = PREV
							any_de_jure_vassal_title = {
								limit = {
									holder_scope = { 
										OR = {
											character = ROOT
											is_liege_or_above = ROOT
										}
									}
								}
								grant_title = PREVPREV
							}
						}
						save_event_target_as = restored_pope
					}
				}
			}
			if = {
				limit = {
					religion = catholic
					NOT = { has_character_flag = restored_catholic_pope_in_rome }
				}
				k_papal_state = {
					holder_scope = {
						opinion = {
							who = ROOT
							modifier = opinion_restored_to_rome
						}
					}
				}
				piety = 1000
				set_character_flag = restored_catholic_pope_in_rome
			}
			
			if = {
				limit = {
					religion = fraticelli
				}
				d_fraticelli = {
					holder_scope = {
						c_roma = {
							grant_title = PREV
							any_de_jure_vassal_title = {
								limit = {
									holder_scope = { 
										OR = {
											character = ROOT
											is_liege_or_above = ROOT
										}
									}
								}
								grant_title = PREVPREV
							}
						}
						save_event_target_as = restored_pope
					}
				}
			}
			if = {
				limit = {
					religion = fraticelli
					NOT = { has_character_flag = restored_fraticelli_pope_in_rome }
				}
				piety = 1000
				set_character_flag = restored_fraticelli_pope_in_rome
			}
			hidden_effect = {
				character_event = { id = 39705 }
				set_character_flag = testflagrome
			}
		}
		
		revoke_allowed = {
			always = no
		}
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				NOT = {
					any_demesne_province = {
						NOT = { province_id = 333 }
					}
				}
			}
			modifier = {
				factor = 0
				c_roma = {
					holder_scope = {
						OR = {
							ai = no
							any_liege = { ai = no }  # AI will never take Rome province away from a player
						}
					}
				}
			}
		}
	}
	
	restore_ecumenical_patriarchate = {
		only_independent = yes
		is_high_prio = yes
		ai_check_interval = 36
		
		potential = {
			is_playable = yes
			has_dlc = "Sons of Abraham"
			religion = orthodox
			has_landed_title = c_byzantion
			independent = yes
			k_orthodox = {
				NOT = {
					holder_scope = {
						religion = orthodox
					}
				}
			}
			NOT = {
				has_alternate_start_parameter = { key = religion_names value = random }
			}
		}
		allow = {
			piety = 1000
			OR = {
				owns = 496 # Constantinople
				any_realm_lord = {
					owns = 496
				}
			}
		}
		effect = {
			piety = -1000
			hidden_tooltip = {
				if = {
					limit = {
						NOT = { is_title_active = k_orthodox }
					}
					activate_title = { title = k_orthodox status = yes }
				}
				create_random_priest = {
					random_traits = yes
					religion = ROOT
					female = no
					dynasty = none
				}
				new_character = {
					k_orthodox = {
						grant_title = PREV
					}
					b_hagiasophia = {
						grant_title = PREV
					}
					wealth = 500
				}
			}
			hidden_effect = {
				long_character_event = { id = 39706 }
			}
		}
	}
	african_tolerate_abrahamics = {
		only_playable = yes
		ai_check_interval = 36

		potential = {
			religion = west_african_pagan # Only unreformed. Reformers can pick the Syncretism Doctrine to sympathize with everyone they wish.
			NOR = {
				trait = sympathy_christendom
				trait = sympathy_islam
				trait = sympathy_judaism
				has_character_flag = flag_picking_sympathy
			}
			NOT = {
				has_alternate_start_parameter = { key = religion_names value = random }
			}
		}
		allow = {
			NOT = {
				trait = zealous
			}
			custom_tooltip = {
				text = african_sympathy_abrahamic
				hidden_tooltip = {
					OR = {
						any_neighbor_independent_ruler = {
							OR = {
								religion_group = christian
								religion_group = muslim
								religion_group = jewish_group
							}
						}
						any_liege = {
							OR = {
								religion_group = christian
								religion_group = muslim
								religion_group = jewish_group
							}
						}
					}
				}
			}
			piety = 50
		}
		effect = {
			custom_tooltip = { text = tooltip_african_picking_syncretism }
			hidden_tooltip = { character_event = { id = HFP.23027 } }
			piety = -50
		}
		ai_will_do = {
			factor = 1
		}
	}
	prussianist_training = {
		only_playable = yes
		ai_check_interval = 36

		potential = {
			religion = prussianist 
			NOT = {
				has_alternate_start_parameter = { key = religion_names value = random }
			}
			NOT = {
				has_character_flag = completed_prussianist_training
			}
		}
		allow = {
			NOR = {
				trait = cynical
				trait = craven
			}

			piety = 50
		}
		effect = {
			set_character_flag = completed_prussianist_training
			hidden_tooltip = { character_event = { id = prussianistevents.1 } }
			piety = -50
		}
		ai_will_do = {
			factor = 1
		}
	}
	become_prussian = {
		only_playable = yes
		ai_check_interval = 36

		potential = {
			religion = prussianist 
			NOT = {
				culture = prussian
			}
		}
		allow = {
			trait = zealous
			prestige = 500
		}
		effect = {
			culture = prussian
			prestige = -500
			piety = 100
		}
		ai_will_do = {
			factor = 1
		}
	}
	choose_novelist_patron = {
		only_playable = yes
		ai_check_interval = 36

		potential = {
			OR = {
				religion = novelist 
				religion = novelist_reformed
			}
			NOT = {
				has_character_flag = picked_novelist_patron
			}
		}
		allow = {
			piety = 50
		}
		effect = {
			set_character_flag = picked_novelist_patron
			hidden_tooltip = { character_event = { id = novelistevents.1 } }
			piety = -50			
		}
		ai_will_do = {
			factor = 1
		}
	}	
	
}
targeted_decisions = {

	vassal_sacrifice_decision = {
		only_playable = yes
	    diplomacy_icon = GFX_sacrifice_decision
	
		ai_target_filter = home_court
		ai_check_interval = 6
	
		from_potential = {
			is_playable = yes
			religion = jacobinist
		}
	
		potential = {
			prisoner = yes
			is_adult = yes
			host = { character = FROM }
		}
		
		allow = {
			NOT = { diplomatic_immunity = yes }
			prisoner = yes
		}
		
		effect = {
			any_liege = {
				limit = { 
					ai = no
					NOT = { character = FROM }
				}
				character_event = { id = SSI.60 }
			}
			hidden_tooltip = {
				FROM = {
					character_event = { id = SSI.72 }
				}
				if = {
					limit = {
						controls_religion = yes
						NOR = {
							religion = aztec
							religion = aztec_reformed
						}
						FROM = { ai = no }
					}
					FROM = { set_character_flag = achievement_holy_smoke }
				}
			}
			death = {
				death_reason = death_execution_aztec_sacrifice
				killer = FROM
			}
		}
		revoke_allowed = {
			always = no
		}
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				trait = cynical
			}
			modifier = {
				factor = 1.5
				trait = zealous
			}
			modifier = {
				factor = 1.5
				trait = bloodthirsty_gods_1
			}
			modifier = {
				factor = 1.75
				trait = bloodthirsty_gods_2
			}
			modifier = {
				factor = 2
				trait = bloodthirsty_gods_3
			}
		}
	}
	
	stalinist_fabricate_evidence = {
		only_playable = yes
		only_independent = yes
		
		ai_check_interval = 36
		from_potential = {
			is_playable = yes
			religion = stalinist
		}
		potential = {
			vassal_of = FROM
		}
		allow = {#This is meant to allow a stalinist independent ruler to spend a scaling amount of piety to gain a reason to imprison a vassal (FROM in this context is the player character)
			OR = {
				AND = {
					FROM = {#If FROM has enough prestige and piety
						prestige = 100
						piety = 100
					}
					ROOT = {
						primary_title = {#and the target's title is of an appropriate tier for the amount spent
							tier = COUNT
						}
					}
				}
				AND = {
					FROM = {
						prestige = 250
						piety = 250
					}
					ROOT = {
					primary_title = {
						tier = DUKE
					}	
					}
				}
				AND = {
					FROM = {
						prestige = 500
						piety = 500
					}
					ROOT = {
					primary_title = {
						tier = KING
					}
				    }
				}				
			}
		}
		effect = {
			if = {
				limit = {
					ROOT = {
							primary_title = {
							tier = KING
						}						
					}
				}
				FROM = {
					prestige = -500
					piety = -500
				}
				ROOT = {
					character_event = { id = stalin.1 }				
				}
			}
			else_if = {
				limit = {
					ROOT = {
							primary_title = {
							tier = DUKE
						}						
					}
				}
				FROM = {
					prestige = -250
					piety = -250
				}
				ROOT = {
					character_event = { id = stalin.1 }				
				}
			}
			else_if = {
				limit = {
					ROOT = {
							primary_title = {
							tier = COUNT
						}						
					}
				}
				FROM = {
					prestige = -100
					piety = -100
				}
				ROOT = {
					character_event = { id = stalin.1 }				
				}
			}
		}
		revoke_allowed = {
			always = no
		}
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				trait = cynical
			}
			modifier = {
				factor = 1.5
				trait = zealous
			}
		}
	}
	
}	
